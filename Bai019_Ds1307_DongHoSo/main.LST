C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          #include "main.h"
   2          #include "..\lib\Soft_I2c.h"
   3          #include "..\lib\Lcd4.h"
   4          #include "..\lib\Rtc_Ds1307.h"
   5          #include "Port.h"
   6          
   7          #define LED P2_1
   8          #define LED1 P3_7
   9          
  10          unsigned char *code Days[] = {"SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"};
  11          
  12          void delay_ms1(unsigned int time)
  13          {
  14   1        unsigned int x, y;
  15   1        for (x = 0; x < time; x++)
  16   1          for (y = 0; y < 125; y++)
  17   1          {
  18   2          }
  19   1      }
  20          
  21          void delay_ms_CL(int ms)
  22          {
  23   1        while (ms--)
  24   1        {
  25   2          TMOD = 0x01;
  26   2          TH0 = 0xfc;
  27   2          TL0 = 0x18;
  28   2          TR0 = 1;
  29   2          while (!TF0)
  30   2            ;
  31   2          TF0 = 0;
  32   2          TR0 = 0;
  33   2        }
  34   1      }
  35          
  36          void timer_delay() /* Timer0 delay function */
  37          {
  38   1        TH0 = 0xFC; /* Load higher 8-bit in TH0 */
  39   1        TL0 = 0x74; /* Load lower 8-bit in TL0 */
  40   1        TR0 = 1;  /* Start timer0 */
  41   1        while (TF0 == 0)
  42   1          ;  /* Wait until timer0 flag set */
  43   1        TR0 = 0; /* Stop timer0 */
  44   1        TF0 = 0; /* Clear timer0 flag */
  45   1      }
  46          
  47          unsigned int count;
  48          unsigned int mode_clock;
  49          unsigned int temp;
  50          unsigned int Hour_setup;
  51          unsigned int Minute_setup;
  52          unsigned int demc;
  53          unsigned int hi;
  54          
  55          void Delay_ngao(unsigned int Time)
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 2   

  56          {
  57   1        while (Time--)
  58   1          ;
  59   1      }
  60          //-----------------
  61          void print_LCD(unsigned char Hour,
  62                   unsigned char Minute,
  63                   unsigned char Second,
  64                   unsigned char Day,
  65                   unsigned char Date,
  66                   unsigned char Month,
  67                   unsigned char Year)
  68          {
  69   1        Lcd_Chr(1, 5, Hour / 10 + 0x30);
  70   1        Lcd_Chr_Cp(Hour % 10 + 0x30);
  71   1        Lcd_Chr_Cp(':');
  72   1        Lcd_Chr_Cp(Minute / 10 + 0x30);
  73   1        Lcd_Chr_Cp(Minute % 10 + 0x30);
  74   1        Lcd_Chr_Cp(':');
  75   1        Lcd_Chr_Cp(Second / 10 + 0x30);
  76   1        Lcd_Chr_Cp(Second % 10 + 0x30);
  77   1        Lcd_Out(2, 1, "                ");
  78   1        Lcd_Out(2, 2, Days[Day - 1]);
  79   1        Lcd_Chr_Cp(' ');
  80   1        Lcd_Chr_Cp(Date / 10 + 0x30);
  81   1        Lcd_Chr_Cp(Date % 10 + 0x30);
  82   1        Lcd_Chr_Cp('/');
  83   1        Lcd_Chr_Cp(Month / 10 + 0x30);
  84   1        Lcd_Chr_Cp(Month % 10 + 0x30);
  85   1        Lcd_Out_Cp("/20");
  86   1        Lcd_Chr_Cp(Year / 10 + 0x30);
  87   1        Lcd_Chr_Cp(Year % 10 + 0x30);
  88   1      }
  89          
  90          void Baothuc(unsigned char Hour_setup,
  91                 unsigned char Minute_setup,
  92                 unsigned char Hour,
  93                 unsigned char Minute)
  94          {
  95   1        if (Hour_setup == Hour)
  96   1          if (Minute_setup == Minute)
  97   1            LED1 = 1;
  98   1          else
  99   1            LED1 = 0;
 100   1      }
 101          
 102          void Up(void) interrupt 0 //Khai báo trình phục vụ ngắt ngoài 1
 103          {
 104   1        mode_clock++;
 105   1      }
 106          
 107          void main()
 108          {
 109   1        unsigned char Hour, Minute, Second, Mode, Day, Date, Month, Year, old_second;
 110   1        unsigned char Hou_CL, Minute_CL, Second_CL;
 111   1        bit am_pm;
 112   1        BTN_MODE = 1;
 113   1        EA = 1;
 114   1        IT0 = 1;
 115   1        EX0 = 1;
 116   1        Soft_I2c_Init();
 117   1        Ds1307_Init();
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 3   

 118   1        Lcd_Init();
 119   1        mode_clock = 0;
 120   1        count = 0;
 121   1        temp = 0;
 122   1        Hou_CL = 0;
 123   1        Minute_CL = 0;
 124   1        Second_CL = 0;
 125   1        Hour_setup = 0;
 126   1        Minute_setup = 0;
 127   1        TMOD = 0x01;
 128   1        //-------------------
 129   1        //Ds1307_Write_Time(10, 10, 10, 12, 0);
 130   1        //Ds1307_Init();
 131   1        // nạp vào xong phải khởi tạo lại
 132   1      
 133   1        while (1)
 134   1        {
 135   2          //LED = 1;
 136   2          // doc va hien thi gio
 137   2          am_pm = Ds1307_Read_Time(&Hour, &Minute, &Second, &Mode);
 138   2          Ds1307_Read_Date(&Day, &Date, &Month, &Year);
 139   2          if (old_second != Second)
 140   2          {
 141   3            old_second = Second;
 142   3            if (Mode == 12)
 143   3            {
 144   4              if (am_pm == 1)
 145   4                Lcd_Out(1, 14, "PM");
 146   4              else
 147   4                Lcd_Out(1, 14, "AM");
 148   4            }
 149   3            else
 150   3              Lcd_Cmd(_LCD_CLEAR);
 151   3            print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 152   3          }
 153   2          LED = 0;
 154   2      
 155   2          //Lcd_Cmd(15);
 156   2          while (mode_clock > 0)
 157   2          {
 158   3            LED = 1;
 159   3            switch (mode_clock)
 160   3            {
 161   4            case 1:
 162   4              Lcd_Out(1, 11, "  ");
 163   4              timer_delay();
 164   4      
 165   4              Lcd_Chr(1, 11, Second / 10 + 0x30);
 166   4              Lcd_Chr_Cp(Second % 10 + 0x30);
 167   4              timer_delay();
 168   4              if (BTN_MOVE == 0)
 169   4              {
 170   5                //Lcd_Cmd(15);
 171   5                delay_ms1(15);
 172   5                do
 173   5                {
 174   6                } while (BTN_MOVE == 0);
 175   5                count = 1;
 176   5                while (mode_clock == 1)
 177   5                {
 178   6                  if (BTN_MOVE == 0)
 179   6                  {
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 4   

 180   7                    delay_ms1(15);
 181   7                    if (BTN_MOVE == 0)
 182   7                      count = count + 1;
 183   7                    do
 184   7                    {
 185   8                    } while (BTN_MOVE == 0);
 186   7                  }
 187   6                  switch (count)
 188   6                  {
 189   7                  case 2:
 190   7                    while (count == 2 && mode_clock == 1)
 191   7                    {
 192   8                      char old_hour = Hour;
 193   8                      if (BTN_MOVE == 0)
 194   8                      {
 195   9                        delay_ms1(15);
 196   9                        if (BTN_MOVE == 0)
 197   9                          count = count + 1;
 198   9                        do
 199   9                        {
 200  10                        } while (BTN_MOVE == 0);
 201   9                      }
 202   8                      else if (BTN_DOWN == 0)
 203   8                      {
 204   9                        delay_ms1(15);
 205   9                        do
 206   9                        {
 207  10                        } while (BTN_DOWN == 0);
 208   9                        if ((Hour == 0) && (Mode == 12))
 209   9                          Hour = 12;
 210   9                        if ((Hour == 0) && (Mode == 24))
 211   9                          Hour = 24;
 212   9                        Hour--;
 213   9                      }
 214   8                      else if (BTN_UP == 0)
 215   8                      {
 216   9                        delay_ms1(15);
 217   9                        do
 218   9                        {
 219  10                        } while (BTN_UP == 0);
 220   9                        if ((Hour == 11) && (Mode == 12))
 221   9                          Hour = -1;
 222   9                        if ((Hour == 23) && (Mode == 24))
 223   9                          Hour = -1;
 224   9                        Hour++;
 225   9                      }
 226   8                      else
 227   8                      {
 228   9                        Lcd_Out(1, 5, "  ");
 229   9                        timer_delay();
 230   9      
 231   9                        Lcd_Chr(1, 5, Hour / 10 + 0x30);
 232   9                        Lcd_Chr_Cp(Hour % 10 + 0x30);
 233   9                        timer_delay();
 234   9                      }
 235   8                      if (old_hour != Hour)
 236   8                      {
 237   9                        old_hour = Hour;
 238   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 239   9                      }
 240   8                      if (count != 2)
 241   8                        break;
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 5   

 242   8                    }
 243   7                    break;
 244   7                  case 1:
 245   7                    while (count == 1 && mode_clock == 1)
 246   7                    {
 247   8                      char old_minute = Minute;
 248   8                      if (BTN_MOVE == 0)
 249   8                      {
 250   9                        delay_ms1(15);
 251   9                        if (BTN_MOVE == 0)
 252   9                          count = count + 1;
 253   9                        do
 254   9                        {
 255  10                        } while (BTN_MOVE == 0);
 256   9                      }
 257   8                      else if (BTN_DOWN == 0)
 258   8                      {
 259   9                        delay_ms1(15);
 260   9                        do
 261   9                        {
 262  10                        } while (BTN_DOWN == 0);
 263   9                        if (Minute == 0)
 264   9                          Minute = 60;
 265   9                        Minute--;
 266   9                      }
 267   8                      else if (BTN_UP == 0)
 268   8                      {
 269   9                        delay_ms1(15);
 270   9                        do
 271   9                        {
 272  10                        } while (BTN_UP == 0);
 273   9                        if (Minute == 59)
 274   9                          Minute = -1;
 275   9                        Minute++;
 276   9                      }
 277   8                      else
 278   8                      {
 279   9                        Lcd_Out(1, 8, "  ");
 280   9                        timer_delay();
 281   9      
 282   9                        Lcd_Chr(1, 8, Minute / 10 + 0x30);
 283   9                        Lcd_Chr_Cp(Minute % 10 + 0x30);
 284   9                        timer_delay();
 285   9                      }
 286   8                      if (old_minute != Minute)
 287   8                      {
 288   9                        old_minute = Minute;
 289   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 290   9                      }
 291   8                      if (count != 1)
 292   8                        break;
 293   8                    }
 294   7                    break;
 295   7                  // case 3:
 296   7                  //  Lcd_Out(1, 11, "__");
 297   7                  //  Delay_ngao(30000);
 298   7      
 299   7                  //  Lcd_Chr(1, 11, Second / 10 + 0x30);
 300   7                  //  Lcd_Chr_Cp(Second % 10 + 0x30);
 301   7                  //  Delay_ngao(30000);
 302   7                  //  while (count == 3 && mode_clock == 1)
 303   7                  //  {
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 6   

 304   7                  //    char old_sec = Second;
 305   7                  //    if (BTN_MOVE == 0)
 306   7                  //    {
 307   7                  //      delay_ms1(15);
 308   7                  //      if (BTN_MOVE == 0)
 309   7                  //        count = count + 1;
 310   7                  //      do
 311   7                  //      {
 312   7                  //      } while (BTN_MOVE == 0);
 313   7                  //    }
 314   7                  //    else if (BTN_DOWN == 0)
 315   7                  //    {
 316   7                  //      delay_ms1(15);
 317   7                  //      do
 318   7                  //      {
 319   7                  //      } while (BTN_DOWN == 0);
 320   7                  //      if (Second == 0)
 321   7                  //        Second = 60;
 322   7                  //      Second--;
 323   7                  //    }
 324   7                  //    else if (BTN_UP == 0)
 325   7                  //    {
 326   7                  //      delay_ms1(15);
 327   7                  //      do
 328   7                  //      {
 329   7                  //      } while (BTN_UP == 0);
 330   7                  //      if (Second == 59)
 331   7                  //        Second = -1;
 332   7                  //      Second++;
 333   7                  //    }
 334   7                  //    if (old_sec != Second)
 335   7                  //    {
 336   7                  //      old_sec = Second;
 337   7                  //      print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 338   7                  //    }
 339   7                  //    if (count != 3)
 340   7                  //      break;
 341   7                  //  }
 342   7                  //  break;
 343   7                  case 3:
 344   7                    while (count == 3 && mode_clock == 1)
 345   7                    {
 346   8                      char old_day = Day;
 347   8                      if (BTN_MOVE == 0)
 348   8                      {
 349   9                        delay_ms1(15);
 350   9                        if (BTN_MOVE == 0)
 351   9                          count = count + 1;
 352   9                        do
 353   9                        {
 354  10                        } while (BTN_MOVE == 0);
 355   9                      }
 356   8                      else if (BTN_DOWN == 0)
 357   8                      {
 358   9                        delay_ms1(15);
 359   9                        do
 360   9                        {
 361  10                        } while (BTN_DOWN == 0);
 362   9                        if (Day == 1)
 363   9                          Day = 8;
 364   9                        Day--;
 365   9                      }
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 7   

 366   8                      else if (BTN_UP == 0)
 367   8                      {
 368   9                        delay_ms1(15);
 369   9                        do
 370   9                        {
 371  10                        } while (BTN_UP == 0);
 372   9                        if (Day == 7)
 373   9                          Day = 0;
 374   9                        Day++;
 375   9                      }
 376   8                      else
 377   8                      {
 378   9                        Lcd_Out(2, 2, "   ");
 379   9                        timer_delay();
 380   9      
 381   9                        Lcd_Out(2, 2, Days[Day - 1]);
 382   9                        Lcd_Chr_Cp(' ');
 383   9                        timer_delay();
 384   9                      }
 385   8                      if (old_day != Day)
 386   8                      {
 387   9                        old_day = Day;
 388   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 389   9                      }
 390   8                      if (count != 3)
 391   8                        break;
 392   8                    }
 393   7                    break;
 394   7                  case 4:
 395   7                    while (count == 4 && mode_clock == 1)
 396   7                    {
 397   8                      char old_date = Date;
 398   8                      if (BTN_MOVE == 0)
 399   8                      {
 400   9                        delay_ms1(15);
 401   9                        if (BTN_MOVE == 0)
 402   9                          count = count + 1;
 403   9                        do
 404   9                        {
 405  10                        } while (BTN_MOVE == 0);
 406   9                      }
 407   8                      else if (BTN_DOWN == 0)
 408   8                      {
 409   9                        delay_ms1(15);
 410   9                        do
 411   9                        {
 412  10                        } while (BTN_DOWN == 0);
 413   9                        if (Date == 1)
 414   9                          Date = 32;
 415   9                        Date--;
 416   9                      }
 417   8                      else if (BTN_UP == 0)
 418   8                      {
 419   9                        delay_ms1(15);
 420   9                        do
 421   9                        {
 422  10                        } while (BTN_UP == 0);
 423   9                        if (Date == 31)
 424   9                          Date = 0;
 425   9                        Date++;
 426   9                      }
 427   8                      else
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 8   

 428   8                      {
 429   9                        Lcd_Out(2, 6, "  ");
 430   9                        timer_delay();
 431   9      
 432   9                        Lcd_Chr(2, 6, Date / 10 + 0x30);
 433   9                        Lcd_Chr_Cp(Date % 10 + 0x30);
 434   9                        timer_delay();
 435   9                      }
 436   8                      if (old_date != Date)
 437   8                      {
 438   9                        old_date = Date;
 439   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 440   9                      }
 441   8                      if (count != 4)
 442   8                        break;
 443   8                    }
 444   7                    break;
 445   7                  case 5:
 446   7                    while (count == 5 && mode_clock == 1)
 447   7                    {
 448   8                      char old_month = Month;
 449   8                      if (BTN_MOVE == 0)
 450   8                      {
 451   9                        delay_ms1(15);
 452   9                        if (BTN_MOVE == 0)
 453   9                          count = count + 1;
 454   9                        do
 455   9                        {
 456  10                        } while (BTN_MOVE == 0);
 457   9                      }
 458   8                      else if (BTN_DOWN == 0)
 459   8                      {
 460   9                        delay_ms1(15);
 461   9                        do
 462   9                        {
 463  10                        } while (BTN_DOWN == 0);
 464   9                        if (Month == 1)
 465   9                          Month = 13;
 466   9                        Month--;
 467   9                      }
 468   8                      else if (BTN_UP == 0)
 469   8                      {
 470   9                        delay_ms1(15);
 471   9                        do
 472   9                        {
 473  10                        } while (BTN_UP == 0);
 474   9                        if (Month == 12)
 475   9                          Month = 0;
 476   9                        Month++;
 477   9                      }
 478   8                      else
 479   8                      {
 480   9                        Lcd_Out(2, 9, "  ");
 481   9                        timer_delay();
 482   9      
 483   9                        Lcd_Chr(2, 9, Month / 10 + 0x30);
 484   9                        Lcd_Chr_Cp(Month % 10 + 0x30);
 485   9                        timer_delay();
 486   9                      }
 487   8                      if (old_month != Month)
 488   8                      {
 489   9                        old_month = Month;
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 9   

 490   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 491   9                      }
 492   8                      if (count != 5)
 493   8                        break;
 494   8                    }
 495   7                    break;
 496   7                  case 6:
 497   7                    while (count == 6 && mode_clock == 1)
 498   7                    {
 499   8                      char old_year = Year;
 500   8                      if (BTN_MOVE == 0)
 501   8                      {
 502   9                        delay_ms1(15);
 503   9                        if (BTN_MOVE == 0)
 504   9                          count = count + 1;
 505   9                        do
 506   9                        {
 507  10                        } while (BTN_MOVE == 0);
 508   9                      }
 509   8                      else if (BTN_DOWN == 0)
 510   8                      {
 511   9                        delay_ms1(15);
 512   9                        do
 513   9                        {
 514  10                        } while (BTN_DOWN == 0);
 515   9                        Year--;
 516   9                      }
 517   8                      else if (BTN_UP == 0)
 518   8                      {
 519   9                        delay_ms1(15);
 520   9                        do
 521   9                        {
 522  10                        } while (BTN_UP == 0);
 523   9                        Year++;
 524   9                      }
 525   8                      else
 526   8                      {
 527   9                        Lcd_Out(2, 12, "    ");
 528   9                        timer_delay();
 529   9                        Lcd_Out(2, 12, "20");
 530   9                        Lcd_Chr(2, 14, Year / 10 + 0x30);
 531   9                        //Lcd_Chr_Cp(Year / 10 + 0x30);
 532   9                        Lcd_Chr_Cp(Year % 10 + 0x30);
 533   9                        timer_delay();
 534   9                      }
 535   8                      if (old_year != Year)
 536   8                      {
 537   9                        old_year = Year;
 538   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 539   9                      }
 540   8                      if (count != 6)
 541   8                        break;
 542   8                    }
 543   7                    break;
 544   7                  default:
 545   7                    break; // Error handling
 546   7                  }
 547   6                  if (count >= 7)
 548   6                  {
 549   7                    mode_clock++;
 550   7                    // Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 551   7                    // Ds1307_Write_Date(Day, Date, Month, Year);
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 10  

 552   7                    // Ds1307_Init();
 553   7                    break;
 554   7                  }
 555   6                }
 556   5                if (mode_clock != 1)
 557   5                  break;
 558   5              }
 559   4              break;
 560   4              //while(mode_clock == 1){}
 561   4            case 2:
 562   4              Lcd_Cmd(1);
 563   4              Lcd_Out(1, 1, "CAI DAT BAO THUC");
 564   4              delay_ms1(15);
 565   4              if (BTN_MOVE == 0)
 566   4              {
 567   5                // Lcd_Cmd(1);
 568   5                // Lcd_Out(1, 1, "CAI DAT BAO THUC");
 569   5                // Lcd_Chr(2, 6, 0 / 10 + 0x30);
 570   5                // Lcd_Chr_Cp(0 % 10 + 0x30);
 571   5                // Lcd_Chr_Cp(':');
 572   5                // Lcd_Chr_Cp(0 / 10 + 0x30);
 573   5                // Lcd_Chr_Cp(0 % 10 + 0x30);
 574   5                delay_ms1(15);
 575   5                temp = 1;
 576   5                do
 577   5                {
 578   6                } while (BTN_MOVE == 0);
 579   5                while (mode_clock == 2)
 580   5                {
 581   6                  if (BTN_MOVE == 0)
 582   6                  {
 583   7                    delay_ms1(15);
 584   7                    if (BTN_MOVE == 0)
 585   7                      temp = temp + 1;
 586   7                    do
 587   7                    {
 588   8                    } while (BTN_MOVE == 0);
 589   7                  }
 590   6      
 591   6                  switch (temp)
 592   6                  {
 593   7                  case 1:
 594   7                    Lcd_Out(2, 6, "  ");
 595   7                    Lcd_Chr_Cp(':');
 596   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 597   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 598   7                    Delay_ngao(30000);
 599   7      
 600   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 601   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 602   7                    Lcd_Chr_Cp(':');
 603   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 604   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 605   7                    Delay_ngao(30000);
 606   7                    Lcd_Out(1, 1, "CAI DAT BAO THUC");
 607   7                    while (temp == 1 && mode_clock == 2)
 608   7                    {
 609   8                      char old_Hour_setup = Hour_setup;
 610   8                      if (BTN_MOVE == 0)
 611   8                      {
 612   9                        delay_ms1(15);
 613   9                        if (BTN_MOVE == 0)
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 11  

 614   9                          temp = temp + 1;
 615   9                        do
 616   9                        {
 617  10                        } while (BTN_MOVE == 0);
 618   9                      }
 619   8                      else if (BTN_DOWN == 0)
 620   8                      {
 621   9                        delay_ms1(15);
 622   9                        do
 623   9                        {
 624  10                        } while (BTN_DOWN == 0);
 625   9                        if ((Hour_setup == 0) && (Mode == 12))
 626   9                          Hour_setup = 12;
 627   9                        if ((Hour_setup == 0) && (Mode == 24))
 628   9                          Hour_setup = 24;
 629   9                        Hour_setup--;
 630   9                      }
 631   8                      else if (BTN_UP == 0)
 632   8                      {
 633   9                        delay_ms1(15);
 634   9                        do
 635   9                        {
 636  10                        } while (BTN_UP == 0);
 637   9                        if ((Hour_setup == 11) && (Mode == 12))
 638   9                          Hour_setup = -1;
 639   9                        if ((Hour_setup == 23) && (Mode == 24))
 640   9                          Hour_setup = -1;
 641   9                        Hour_setup++;
 642   9                      }
 643   8                      else
 644   8                      {
 645   9                        Lcd_Out(2, 6, "  ");
 646   9                        Lcd_Chr_Cp(':');
 647   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 648   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 649   9                        timer_delay();
 650   9      
 651   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 652   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 653   9                        Lcd_Chr_Cp(':');
 654   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 655   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 656   9                        timer_delay();
 657   9                      }
 658   8                      if (old_Hour_setup != Hour_setup)
 659   8                      {
 660   9                        old_Hour_setup = Hour_setup;
 661   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 662   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 663   9                        Lcd_Chr_Cp(':');
 664   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 665   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 666   9                      }
 667   8                    }
 668   7                    break;
 669   7                  case 2:
 670   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 671   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 672   7                    Lcd_Chr_Cp(':');
 673   7                    Lcd_Out(2, 9, "  ");
 674   7                    Delay_ngao(30000);
 675   7      
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 12  

 676   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 677   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 678   7                    Lcd_Chr_Cp(':');
 679   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 680   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 681   7                    Delay_ngao(30000);
 682   7                    Lcd_Out(1, 1, "CAI DAT BAO THUC");
 683   7                    while (temp == 2 && mode_clock == 2)
 684   7                    {
 685   8                      char old_Minute_setup = Minute_setup;
 686   8                      if (BTN_MOVE == 0)
 687   8                      {
 688   9                        delay_ms1(15);
 689   9                        if (BTN_MOVE == 0)
 690   9                          temp = temp + 1;
 691   9                        do
 692   9                        {
 693  10                        } while (BTN_MOVE == 0);
 694   9                      }
 695   8                      else if (BTN_DOWN == 0)
 696   8                      {
 697   9                        delay_ms1(15);
 698   9                        do
 699   9                        {
 700  10                        } while (BTN_DOWN == 0);
 701   9                        if (Minute_setup == 0)
 702   9                          Minute_setup = 60;
 703   9                        Minute_setup--;
 704   9                      }
 705   8                      else if (BTN_UP == 0)
 706   8                      {
 707   9                        delay_ms1(15);
 708   9                        do
 709   9                        {
 710  10                        } while (BTN_UP == 0);
 711   9                        if (Minute_setup == 59)
 712   9                          Minute_setup = -1;
 713   9                        Minute_setup++;
 714   9                      }
 715   8                      else
 716   8                      {
 717   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 718   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 719   9                        Lcd_Chr_Cp(':');
 720   9                        Lcd_Out(2, 9, "  ");
 721   9                        timer_delay();
 722   9      
 723   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 724   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 725   9                        Lcd_Chr_Cp(':');
 726   9                        Lcd_Chr(2, 9, Minute_setup / 10 + 0x30);
 727   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 728   9                        // Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 729   9                        // Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 730   9                        timer_delay();
 731   9                      }
 732   8                      if (old_Minute_setup != Minute_setup)
 733   8                      {
 734   9                        old_Minute_setup = Minute_setup;
 735   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 736   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 737   9                        Lcd_Chr_Cp(':');
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 13  

 738   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 739   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 740   9                      }
 741   8                      if (temp != 2)
 742   8                      {
 743   9                        Lcd_Cmd(1);
 744   9                        break;
 745   9                      }
 746   8                    }
 747   7                    break;
 748   7                  default:
 749   7                    break;
 750   7                  }
 751   6                  if (temp >= 3)
 752   6                  {
 753   7                    mode_clock++;
 754   7                    break;
 755   7                  }
 756   6                }
 757   5                if (mode_clock != 2)
 758   5                  break;
 759   5              }
 760   4              break;
 761   4            case 3:
 762   4              demc = 1;
 763   4              Lcd_Cmd(1);
 764   4              Lcd_Out(1, 2, "DONG HO BAM GIO");
 765   4              Lcd_Chr(2, 5, Hou_CL / 10 + 0x30);
 766   4              Lcd_Chr_Cp(Hou_CL % 10 + 0x30);
 767   4              Lcd_Chr_Cp(':');
 768   4              Lcd_Chr_Cp(Minute_CL / 10 + 0x30);
 769   4              Lcd_Chr_Cp(Minute_CL % 10 + 0x30);
 770   4              Lcd_Chr_Cp(':');
 771   4              Lcd_Chr_Cp(Second_CL / 10 + 0x30);
 772   4              Lcd_Chr_Cp(Second_CL % 10 + 0x30);
 773   4              delay_ms1(15);
 774   4              while (mode_clock == 3)
 775   4              {
 776   5                char old_Hou_CL = Hou_CL;
 777   5                if (BTN_MOVE == 0)
 778   5                {
 779   6                  delay_ms1(15);
 780   6                  if (BTN_MOVE == 0)
 781   6                    demc = demc + 1;
 782   6                  do
 783   6                  {
 784   7                  } while (BTN_MOVE == 0);
 785   6                  while (demc % 2 == 0 && mode_clock == 3)
 786   6                  {
 787   7                    int j = 0;
 788   7                    Second_CL++;
 789   7                    for (hi = 0; hi < 35; hi++)
 790   7                    {
 791   8                      // delay_ms_CL(10);
 792   8                      // delay_ms_CL(10);
 793   8                      // delay_ms_CL(10);
 794   8                      for (j = 0; j < 25; j++)
 795   8                      {
 796   9                        timer_delay();
 797   9                      }
 798   8                      Lcd_Chr(2, 5, Hou_CL / 10 + 0x30);
 799   8                      Lcd_Chr_Cp(Hou_CL % 10 + 0x30);
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 14  

 800   8                      Lcd_Chr_Cp(':');
 801   8                      Lcd_Chr_Cp(Minute_CL / 10 + 0x30);
 802   8                      Lcd_Chr_Cp(Minute_CL % 10 + 0x30);
 803   8                      Lcd_Chr_Cp(':');
 804   8                      Lcd_Chr_Cp(Second_CL / 10 + 0x30);
 805   8                      Lcd_Chr_Cp(Second_CL % 10 + 0x30);
 806   8                    }
 807   7                    if (BTN_MOVE == 0)
 808   7                    {
 809   8                      delay_ms1(15);
 810   8                      demc = demc + 1;
 811   8                      do
 812   8                      {
 813   9                      } while (BTN_MOVE == 0);
 814   8                    }
 815   7                    else if (BTN_DOWN == 0)
 816   7                    {
 817   8                      delay_ms1(15);
 818   8                      do
 819   8                      {
 820   9                      } while (BTN_DOWN == 0);
 821   8                      Hou_CL = 0;
 822   8                      Minute_CL = 0;
 823   8                      Second_CL = 0;
 824   8                      Lcd_Chr(2, 5, Hou_CL / 10 + 0x30);
 825   8                      Lcd_Chr_Cp(Hou_CL % 10 + 0x30);
 826   8                      Lcd_Chr_Cp(':');
 827   8                      Lcd_Chr_Cp(Minute_CL / 10 + 0x30);
 828   8                      Lcd_Chr_Cp(Minute_CL % 10 + 0x30);
 829   8                      Lcd_Chr_Cp(':');
 830   8                      Lcd_Chr_Cp(Second_CL / 10 + 0x30);
 831   8                      Lcd_Chr_Cp(Second_CL % 10 + 0x30);
 832   8                      demc++;
 833   8                    }
 834   7                    if (Second_CL == 59)
 835   7                      Minute_CL++;
 836   7                    if (Minute_CL == 59)
 837   7                      Hou_CL++;
 838   7                    if (Second_CL > 59)
 839   7                      Second_CL = 0;
 840   7                    if (Minute_CL > 59)
 841   7                      Minute_CL = 0;
 842   7                  }
 843   6                }
 844   5                if (BTN_DOWN == 0)
 845   5                {
 846   6                  delay_ms1(15);
 847   6                  do
 848   6                  {
 849   7                  } while (BTN_DOWN == 0);
 850   6                  Hou_CL = 0;
 851   6                  Minute_CL = 0;
 852   6                  Second_CL = 0;
 853   6                  Lcd_Chr(2, 5, Hou_CL / 10 + 0x30);
 854   6                  Lcd_Chr_Cp(Hou_CL % 10 + 0x30);
 855   6                  Lcd_Chr_Cp(':');
 856   6                  Lcd_Chr_Cp(Minute_CL / 10 + 0x30);
 857   6                  Lcd_Chr_Cp(Minute_CL % 10 + 0x30);
 858   6                  Lcd_Chr_Cp(':');
 859   6                  Lcd_Chr_Cp(Second_CL / 10 + 0x30);
 860   6                  Lcd_Chr_Cp(Second_CL % 10 + 0x30);
 861   6                }
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 15  

 862   5              }
 863   4              break;
 864   4            default:
 865   4              //LED = 1;
 866   4              //Delay(50000);
 867   4              break; // Error handling
 868   4            }
 869   3            if (mode_clock >= 4)
 870   3            {
 871   4              Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 872   4              Ds1307_Write_Date(Day, Date, Month, Year);
 873   4              Ds1307_Init();
 874   4              mode_clock = 0;
 875   4              break;
 876   4            }
 877   3          }
 878   2          //==================
 879   2          if (BTN_MOVE == 0)
 880   2          {
 881   3            LED = 0;
 882   3            delay_ms1(15);
 883   3            if (BTN_MOVE == 0)
 884   3            {
 885   4              if (Mode == 12)
 886   4              {
 887   5                if (am_pm == 1)
 888   5                  Hour = Hour + 12;
 889   5                Mode = 24;
 890   5              }
 891   4              else
 892   4              {
 893   5                if (Hour >= 12)
 894   5                  Hour = Hour - 12;
 895   5                Mode = 12;
 896   5              }
 897   4              Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 898   4              Ds1307_Init();
 899   4            }
 900   3            do
 901   3            {
 902   4            } while (BTN_MOVE == 0);
 903   3          }
 904   2      
 905   2          if ((Hour_setup == Hour) && (Minute_setup == Minute))
 906   2          {
 907   3            LED1 = 1;
 908   3          }
 909   2          else
 910   2            LED1 = 0;
 911   2      
 912   2          //Baothuc(Hour_setup, Minute_setup, Hour, Minute_setup);
 913   2        }
 914   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3851    ----
   CONSTANT SIZE    =    124    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14      26
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   MAIN                                                              06/26/2021 22:37:56 PAGE 16  

   BIT SIZE         =   ----       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
