<<<<<<< HEAD
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 1   
=======
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 1   
>>>>>>> 3ee300c1f9e4dad49057a9c8ba7e4389ff8675df


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          #include "main.h"
   2          #include "..\lib\Soft_I2c.h"
   3          #include "..\lib\Lcd4.h"
   4          #include "..\lib\Rtc_Ds1307.h"
   5          #include "Port.h"
   6          
   7          #define LED P2_1
   8          #define LED1 P3_7
   9          
  10          unsigned char *code Days[] = {"SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"};
  11          
  12          void delay_ms1(unsigned int time)
  13          {
  14   1        unsigned int x, y;
  15   1        for (x = 0; x < time; x++)
  16   1          for (y = 0; y < 125; y++)
  17   1          {
  18   2          }
  19   1      }
  20          unsigned int count;
<<<<<<< HEAD
  21          unsigned int mode_clock;
=======
  21          unsigned int mode_;
>>>>>>> 3ee300c1f9e4dad49057a9c8ba7e4389ff8675df
  22          unsigned int temp;
  23          unsigned int Hour_setup;
  24          unsigned int Minute_setup;
  25          
  26          void Delay_ngao(unsigned int Time)
  27          {
  28   1        while (Time--)
  29   1          ;
  30   1      }
  31          //-----------------
  32          void print_LCD(unsigned char Hour,
  33                   unsigned char Minute,
  34                   unsigned char Second,
  35                   unsigned char Day,
  36                   unsigned char Date,
  37                   unsigned char Month,
  38                   unsigned char Year)
  39          {
  40   1        Lcd_Chr(1, 5, Hour / 10 + 0x30);
  41   1        Lcd_Chr_Cp(Hour % 10 + 0x30);
  42   1        Lcd_Chr_Cp(':');
  43   1        Lcd_Chr_Cp(Minute / 10 + 0x30);
  44   1        Lcd_Chr_Cp(Minute % 10 + 0x30);
  45   1        Lcd_Chr_Cp(':');
  46   1        Lcd_Chr_Cp(Second / 10 + 0x30);
  47   1        Lcd_Chr_Cp(Second % 10 + 0x30);
  48   1        Lcd_Out(2, 1, "                ");
  49   1        Lcd_Out(2, 2, Days[Day - 1]);
  50   1        Lcd_Chr_Cp(' ');
  51   1        Lcd_Chr_Cp(Date / 10 + 0x30);
  52   1        Lcd_Chr_Cp(Date % 10 + 0x30);
  53   1        Lcd_Chr_Cp('/');
  54   1        Lcd_Chr_Cp(Month / 10 + 0x30);
  55   1        Lcd_Chr_Cp(Month % 10 + 0x30);
<<<<<<< HEAD
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 2   
=======
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 2   
>>>>>>> 3ee300c1f9e4dad49057a9c8ba7e4389ff8675df

  56   1        Lcd_Out_Cp("/20");
  57   1        Lcd_Chr_Cp(Year / 10 + 0x30);
  58   1        Lcd_Chr_Cp(Year % 10 + 0x30);
  59   1      }
  60          
  61          void Baothuc(unsigned char Hour_setup,
  62                 unsigned char Minute_setup,
  63                 unsigned char Hour,
  64                 unsigned char Minute)
  65          {
  66   1        if (Hour_setup == Hour)
  67   1          if (Minute_setup == Minute)
  68   1            LED1 = 1;
  69   1          else
  70   1            LED1 = 0;
  71   1      }
  72          
<<<<<<< HEAD
  73          void Up(void) interrupt 0 //Khai báo trình phục vụ ngắt ngoài 1
  74          {
  75   1        mode_clock++;
  76   1      }
  77          
  78          void main()
  79          {
  80   1        unsigned char Hour, Minute, Second, Mode, Day, Date, Month, Year, old_second;
  81   1        bit am_pm;
  82   1        BTN_MODE = 1;
  83   1        EA = 1;
  84   1        IT0 = 1;
  85   1        EX0 = 1;
  86   1        Soft_I2c_Init();
  87   1        Ds1307_Init();
  88   1        Lcd_Init();
  89   1        mode_clock = 0;
  90   1        count = 0;
  91   1        //-------------------
  92   1        //Ds1307_Write_Time(10, 10, 10, 12, 0);
  93   1        //Ds1307_Init();
  94   1        // nạp vào xong phải khởi tạo lại
  95   1      
  96   1        while (1)
  97   1        {
  98   2          //LED = 1;
  99   2          // doc va hien thi gio
 100   2          am_pm = Ds1307_Read_Time(&Hour, &Minute, &Second, &Mode);
 101   2          Ds1307_Read_Date(&Day, &Date, &Month, &Year);
 102   2          if (old_second != Second)
 103   2          {
 104   3            old_second = Second;
 105   3            if (Mode == 12)
 106   3            {
 107   4              if (am_pm == 1)
 108   4                Lcd_Out(1, 14, "PM");
 109   4              else
 110   4                Lcd_Out(1, 14, "AM");
 111   4            }
 112   3            else
 113   3              Lcd_Cmd(_LCD_CLEAR);
 114   3            print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 115   3          }
 116   2          LED = 0;
 117   2      
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 3   

 118   2          //Lcd_Cmd(15);
 119   2          while (mode_clock > 0)
 120   2          {
 121   3            LED = 1;
 122   3            switch (mode_clock)
 123   3            {
 124   4            case 1:
 125   4              if (BTN_MOVE == 0)
 126   4              {
 127   5                //Lcd_Cmd(15);
 128   5                delay_ms1(15);
 129   5                do
 130   5                {
 131   6                } while (BTN_MOVE == 0);
 132   5                count = 1;
 133   5                while (mode_clock == 1)
 134   5                {
 135   6                  if (BTN_MOVE == 0)
 136   6                  {
 137   7                    delay_ms1(15);
 138   7                    if (BTN_MOVE == 0)
 139   7                      count = count + 1;
 140   7                    do
 141   7                    {
 142   8                    } while (BTN_MOVE == 0);
 143   7                  }
 144   6                  switch (count)
 145   6                  {
 146   7                  case 1:
 147   7                    Lcd_Out(1, 5, "__");
 148   7                    Delay_ngao(30000);
 149   7      
 150   7                    Lcd_Chr(1, 5, Hour / 10 + 0x30);
 151   7                    Lcd_Chr_Cp(Hour % 10 + 0x30);
 152   7                    Delay_ngao(30000);
 153   7                    while (count == 1 && mode_clock == 1)
 154   7                    {
 155   8                      char old_hour = Hour;
 156   8                      if (BTN_MOVE == 0)
 157   8                      {
 158   9                        delay_ms1(15);
 159   9                        if (BTN_MOVE == 0)
 160   9                          count = count + 1;
 161   9                        do
 162   9                        {
 163  10                        } while (BTN_MOVE == 0);
 164   9                      }
 165   8                      else if (BTN_DOWN == 0)
 166   8                      {
 167   9                        delay_ms1(15);
 168   9                        do
 169   9                        {
 170  10                        } while (BTN_DOWN == 0);
 171   9                        if ((Hour == 0) && (Mode == 12))
 172   9                          Hour = 12;
 173   9                        if ((Hour == 0) && (Mode == 24))
 174   9                          Hour = 24;
 175   9                        Hour--;
 176   9                      }
 177   8                      else if (BTN_UP == 0)
 178   8                      {
 179   9                        delay_ms1(15);
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 4   

 180   9                        do
 181   9                        {
 182  10                        } while (BTN_UP == 0);
 183   9                        if ((Hour == 11) && (Mode == 12))
 184   9                          Hour = -1;
 185   9                        if ((Hour == 23) && (Mode == 24))
 186   9                          Hour = -1;
 187   9                        Hour++;
 188   9                      }
 189   8                      if (old_hour != Hour)
 190   8                      {
 191   9                        old_hour = Hour;
 192   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 193   9                      }
 194   8                      if (count != 1)
 195   8                        break;
 196   8                    }
 197   7                    break;
 198   7                  case 2:
 199   7                    Lcd_Out(1, 8, "__");
 200   7                    Delay_ngao(30000);
 201   7      
 202   7                    Lcd_Chr(1, 8, Minute / 10 + 0x30);
 203   7                    Lcd_Chr_Cp(Minute % 10 + 0x30);
 204   7                    Delay_ngao(30000);
 205   7                    while (count == 2 && mode_clock == 1)
 206   7                    {
 207   8                      char old_minute = Minute;
 208   8                      if (BTN_MOVE == 0)
 209   8                      {
 210   9                        delay_ms1(15);
 211   9                        if (BTN_MOVE == 0)
 212   9                          count = count + 1;
 213   9                        do
 214   9                        {
 215  10                        } while (BTN_MOVE == 0);
 216   9                      }
 217   8                      else if (BTN_DOWN == 0)
 218   8                      {
 219   9                        delay_ms1(15);
 220   9                        do
 221   9                        {
 222  10                        } while (BTN_DOWN == 0);
 223   9                        if (Minute == 0)
 224   9                          Minute = 60;
 225   9                        Minute--;
 226   9                      }
 227   8                      else if (BTN_UP == 0)
 228   8                      {
 229   9                        delay_ms1(15);
 230   9                        do
 231   9                        {
 232  10                        } while (BTN_UP == 0);
 233   9                        if (Minute == 59)
 234   9                          Minute = -1;
 235   9                        Minute++;
 236   9                      }
 237   8                      if (old_minute != Minute)
 238   8                      {
 239   9                        old_minute = Minute;
 240   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 241   9                      }
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 5   

 242   8                      if (count != 2)
 243   8                        break;
 244   8                    }
 245   7                    break;
 246   7                  case 3:
 247   7                    Lcd_Out(1, 11, "__");
 248   7                    Delay_ngao(30000);
 249   7      
 250   7                    Lcd_Chr(1, 11, Second / 10 + 0x30);
 251   7                    Lcd_Chr_Cp(Second % 10 + 0x30);
 252   7                    Delay_ngao(30000);
 253   7                    while (count == 3 && mode_clock == 1)
 254   7                    {
 255   8                      char old_sec = Second;
 256   8                      if (BTN_MOVE == 0)
 257   8                      {
 258   9                        delay_ms1(15);
 259   9                        if (BTN_MOVE == 0)
 260   9                          count = count + 1;
 261   9                        do
 262   9                        {
 263  10                        } while (BTN_MOVE == 0);
 264   9                      }
 265   8                      else if (BTN_DOWN == 0)
 266   8                      {
 267   9                        delay_ms1(15);
 268   9                        do
 269   9                        {
 270  10                        } while (BTN_DOWN == 0);
 271   9                        if (Second == 0)
 272   9                          Second = 60;
 273   9                        Second--;
 274   9                      }
 275   8                      else if (BTN_UP == 0)
 276   8                      {
 277   9                        delay_ms1(15);
 278   9                        do
 279   9                        {
 280  10                        } while (BTN_UP == 0);
 281   9                        if (Second == 59)
 282   9                          Second = -1;
 283   9                        Second++;
 284   9                      }
 285   8                      if (old_sec != Second)
 286   8                      {
 287   9                        old_sec = Second;
 288   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 289   9                      }
 290   8                      if (count != 3)
 291   8                        break;
 292   8                    }
 293   7                    break;
 294   7                  case 4:
 295   7                    Lcd_Out(2, 2, "___");
 296   7                    Delay_ngao(30000);
 297   7      
 298   7                    Lcd_Out(2, 2, Days[Day - 1]);
 299   7                    Lcd_Chr_Cp(' ');
 300   7                    Delay_ngao(30000);
 301   7                    while (count == 4 && mode_clock == 1)
 302   7                    {
 303   8                      char old_day = Day;
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 6   

 304   8                      if (BTN_MOVE == 0)
 305   8                      {
 306   9                        delay_ms1(15);
 307   9                        if (BTN_MOVE == 0)
 308   9                          count = count + 1;
 309   9                        do
 310   9                        {
 311  10                        } while (BTN_MOVE == 0);
 312   9                      }
 313   8                      else if (BTN_DOWN == 0)
 314   8                      {
 315   9                        delay_ms1(15);
 316   9                        do
 317   9                        {
 318  10                        } while (BTN_DOWN == 0);
 319   9                        if (Day == 1)
 320   9                          Day = 8;
 321   9                        Day--;
 322   9                      }
 323   8                      else if (BTN_UP == 0)
 324   8                      {
 325   9                        delay_ms1(15);
 326   9                        do
 327   9                        {
 328  10                        } while (BTN_UP == 0);
 329   9                        if (Day == 7)
 330   9                          Day = 0;
 331   9                        Day++;
 332   9                      }
 333   8                      if (old_day != Day)
 334   8                      {
 335   9                        old_day = Day;
 336   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 337   9                      }
 338   8                      if (count != 4)
 339   8                        break;
 340   8                    }
 341   7                    break;
 342   7                  case 5:
 343   7                    Lcd_Out(2, 6, "__");
 344   7                    Delay_ngao(30000);
 345   7      
 346   7                    Lcd_Chr(2, 6, Date / 10 + 0x30);
 347   7                    Lcd_Chr_Cp(Date % 10 + 0x30);
 348   7                    Delay_ngao(30000);
 349   7                    while (count == 5 && mode_clock == 1)
 350   7                    {
 351   8                      char old_date = Date;
 352   8                      if (BTN_MOVE == 0)
 353   8                      {
 354   9                        delay_ms1(15);
 355   9                        if (BTN_MOVE == 0)
 356   9                          count = count + 1;
 357   9                        do
 358   9                        {
 359  10                        } while (BTN_MOVE == 0);
 360   9                      }
 361   8                      else if (BTN_DOWN == 0)
 362   8                      {
 363   9                        delay_ms1(15);
 364   9                        do
 365   9                        {
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 7   

 366  10                        } while (BTN_DOWN == 0);
 367   9                        if (Date == 1)
 368   9                          Date = 32;
 369   9                        Date--;
 370   9                      }
 371   8                      else if (BTN_UP == 0)
 372   8                      {
 373   9                        delay_ms1(15);
 374   9                        do
 375   9                        {
 376  10                        } while (BTN_UP == 0);
 377   9                        if (Date == 31)
 378   9                          Date = 0;
 379   9                        Date++;
 380   9                      }
 381   8                      if (old_date != Date)
 382   8                      {
 383   9                        old_date = Date;
 384   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 385   9                      }
 386   8                      if (count != 5)
 387   8                        break;
 388   8                    }
 389   7                    break;
 390   7                  case 6:
 391   7                    Lcd_Out(2, 9, "__");
 392   7                    Delay_ngao(30000);
 393   7      
 394   7                    Lcd_Chr(2, 9, Month / 10 + 0x30);
 395   7                    Lcd_Chr_Cp(Month % 10 + 0x30);
 396   7                    Delay_ngao(30000);
 397   7                    while (count == 6)
 398   7                    {
 399   8                      char old_month = Month;
 400   8                      if (BTN_MOVE == 0 && mode_clock == 1)
 401   8                      {
 402   9                        delay_ms1(15);
 403   9                        if (BTN_MOVE == 0)
 404   9                          count = count + 1;
 405   9                        do
 406   9                        {
 407  10                        } while (BTN_MOVE == 0);
 408   9                      }
 409   8                      else if (BTN_DOWN == 0)
 410   8                      {
 411   9                        delay_ms1(15);
 412   9                        do
 413   9                        {
 414  10                        } while (BTN_DOWN == 0);
 415   9                        if (Month == 1)
 416   9                          Month = 13;
 417   9                        Month--;
 418   9                      }
 419   8                      else if (BTN_UP == 0)
 420   8                      {
 421   9                        delay_ms1(15);
 422   9                        do
 423   9                        {
 424  10                        } while (BTN_UP == 0);
 425   9                        if (Month == 12)
 426   9                          Month = 0;
 427   9                        Month++;
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 8   

 428   9                      }
 429   8                      if (old_month != Month)
 430   8                      {
 431   9                        old_month = Month;
 432   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 433   9                      }
 434   8                      if (count != 6)
 435   8                        break;
 436   8                    }
 437   7                    break;
 438   7                  case 7:
 439   7                    Lcd_Out(2, 12, "____");
 440   7                    Delay_ngao(30000);
 441   7                    Lcd_Out(2, 12, "20");
 442   7                    Lcd_Chr_Cp(Year / 10 + 0x30);
 443   7                    Lcd_Chr_Cp(Year % 10 + 0x30);
 444   7                    Delay_ngao(30000);
 445   7                    while (count == 7 && mode_clock == 1)
 446   7                    {
 447   8                      char old_year = Year;
 448   8                      if (BTN_MOVE == 0)
 449   8                      {
 450   9                        delay_ms1(15);
 451   9                        if (BTN_MOVE == 0)
 452   9                          count = count + 1;
 453   9                        do
 454   9                        {
 455  10                        } while (BTN_MOVE == 0);
 456   9                      }
 457   8                      else if (BTN_DOWN == 0)
 458   8                      {
 459   9                        delay_ms1(15);
 460   9                        do
 461   9                        {
 462  10                        } while (BTN_DOWN == 0);
 463   9                        Year--;
 464   9                      }
 465   8                      else if (BTN_UP == 0)
 466   8                      {
 467   9                        delay_ms1(15);
 468   9                        do
 469   9                        {
 470  10                        } while (BTN_UP == 0);
 471   9                        Year++;
 472   9                      }
 473   8                      if (old_year != Year)
 474   8                      {
 475   9                        old_year = Year;
 476   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 477   9                      }
 478   8                      if (count != 7)
 479   8                        break;
 480   8                    }
 481   7                    break;
 482   7                  default:
 483   7                    break; // Error handling
 484   7                  }
 485   6                  if (count >= 8)
 486   6                  {
 487   7                    mode_clock++;
 488   7                    // Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 489   7                    // Ds1307_Write_Date(Day, Date, Month, Year);
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 9   

 490   7                    // Ds1307_Init();
 491   7                    break;
 492   7                  }
 493   6                }
 494   5                if (mode_clock != 1)
 495   5                  break;
 496   5              }
 497   4              break;
 498   4            case 2:
 499   4              Lcd_Cmd(1);
 500   4              Lcd_Out(1, 1, "CAI DAT BAO THUC");
 501   4              Lcd_Chr(2, 6, 0 / 10 + 0x30);
 502   4              Lcd_Chr_Cp(0 % 10 + 0x30);
 503   4              Lcd_Chr_Cp(':');
 504   4              Lcd_Chr_Cp(0 / 10 + 0x30);
 505   4              Lcd_Chr_Cp(0 % 10 + 0x30);
 506   4              delay_ms1(15);
 507   4              if (BTN_MOVE == 0)
 508   4              {
 509   5                // Lcd_Cmd(1);
 510   5                // Lcd_Out(1, 1, "CAI DAT BAO THUC");
 511   5                // Lcd_Chr(2, 6, 0 / 10 + 0x30);
 512   5                // Lcd_Chr_Cp(0 % 10 + 0x30);
 513   5                // Lcd_Chr_Cp(':');
 514   5                // Lcd_Chr_Cp(0 / 10 + 0x30);
 515   5                // Lcd_Chr_Cp(0 % 10 + 0x30);
 516   5                delay_ms1(15);
 517   5                temp = 1;
 518   5                do
 519   5                {
 520   6                } while (BTN_MOVE == 0);
 521   5                Hour_setup = 0;
 522   5                Minute_setup = 0;
 523   5                while (mode_clock == 2)
 524   5                {
 525   6                  if (BTN_MOVE == 0)
 526   6                  {
 527   7                    delay_ms1(15);
 528   7                    if (BTN_MOVE == 0)
 529   7                      temp = temp + 1;
 530   7                    do
 531   7                    {
 532   8                    } while (BTN_MOVE == 0);
 533   7                  }
 534   6      
 535   6                  switch (temp)
 536   6                  {
 537   7                  case 1:
 538   7                    Lcd_Out(2, 6, "__");
 539   7                    Lcd_Chr_Cp(':');
 540   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 541   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 542   7                    Delay_ngao(30000);
 543   7      
 544   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 545   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 546   7                    Lcd_Chr_Cp(':');
 547   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 548   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 549   7                    Delay_ngao(30000);
 550   7                    Lcd_Out(1, 1, "CAI DAT BAO THUC");
 551   7                    while (temp == 1 && mode_clock == 2)
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 10  

 552   7                    {
 553   8                      char old_Hour_setup = Hour_setup;
 554   8                      if (BTN_MOVE == 0)
 555   8                      {
 556   9                        delay_ms1(15);
 557   9                        if (BTN_MOVE == 0)
 558   9                          temp = temp + 1;
 559   9                        do
 560   9                        {
 561  10                        } while (BTN_MOVE == 0);
 562   9                      }
 563   8                      else if (BTN_DOWN == 0)
 564   8                      {
 565   9                        delay_ms1(15);
 566   9                        do
 567   9                        {
 568  10                        } while (BTN_DOWN == 0);
 569   9                        if ((Hour_setup == 0) && (Mode == 12))
 570   9                          Hour_setup = 12;
 571   9                        if ((Hour_setup == 0) && (Mode == 24))
 572   9                          Hour_setup = 24;
 573   9                        Hour_setup--;
 574   9                      }
 575   8                      else if (BTN_UP == 0)
 576   8                      {
 577   9                        delay_ms1(15);
 578   9                        do
 579   9                        {
 580  10                        } while (BTN_UP == 0);
 581   9                        if ((Hour_setup == 11) && (Mode == 12))
 582   9                          Hour_setup = -1;
 583   9                        if ((Hour_setup == 23) && (Mode == 24))
 584   9                          Hour_setup = -1;
 585   9                        Hour_setup++;
 586   9                      }
 587   8                      if (old_Hour_setup != Hour_setup)
 588   8                      {
 589   9                        old_Hour_setup = Hour_setup;
 590   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 591   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 592   9                        Lcd_Chr_Cp(':');
 593   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 594   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 595   9                      }
 596   8                    }
 597   7                    break;
 598   7                  case 2:
 599   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 600   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 601   7                    Lcd_Chr_Cp(':');
 602   7                    Lcd_Out(2, 9, "__");
 603   7                    Delay_ngao(30000);
 604   7      
 605   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 606   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 607   7                    Lcd_Chr_Cp(':');
 608   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 609   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 610   7                    Delay_ngao(30000);
 611   7                    Lcd_Out(1, 1, "CAI DAT BAO THUC");
 612   7                    while (temp == 2 && mode_clock == 2)
 613   7                    {
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 11  

 614   8                      char old_Minute_setup = Minute_setup;
 615   8                      if (BTN_MOVE == 0)
 616   8                      {
 617   9                        delay_ms1(15);
 618   9                        if (BTN_MOVE == 0)
 619   9                          temp = temp + 1;
 620   9                        do
 621   9                        {
 622  10                        } while (BTN_MOVE == 0);
 623   9                      }
 624   8                      else if (BTN_DOWN == 0)
 625   8                      {
 626   9                        delay_ms1(15);
 627   9                        do
 628   9                        {
 629  10                        } while (BTN_DOWN == 0);
 630   9                        if (Minute_setup == 0)
 631   9                          Minute_setup = 60;
 632   9                        Minute_setup--;
 633   9                      }
 634   8                      else if (BTN_UP == 0)
 635   8                      {
 636   9                        delay_ms1(15);
 637   9                        do
 638   9                        {
 639  10                        } while (BTN_UP == 0);
 640   9                        if (Minute_setup == 59)
 641   9                          Minute_setup = -1;
 642   9                        Minute_setup++;
 643   9                      }
 644   8                      if (old_Minute_setup != Minute_setup)
 645   8                      {
 646   9                        old_Minute_setup = Minute_setup;
 647   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 648   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 649   9                        Lcd_Chr_Cp(':');
 650   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 651   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 652   9                      }
 653   8                      if (temp != 2)
 654   8                      {
 655   9                        Lcd_Cmd(1);
 656   9                        break;
 657   9                      }
 658   8                    }
 659   7                    break;
 660   7                  default:
 661   7                    break;
 662   7                  }
 663   6                  if (temp >= 3)
 664   6                  {
 665   7                    mode_clock++;
 666   7                    break;
 667   7                  }
 668   6                }
 669   5                if (mode_clock != 2)
 670   5                  break;
 671   5              }
 672   4              break;
 673   4            case 3:
 674   4              Lcd_Cmd(1);
 675   4              Lcd_Out(1, 2, "DONG HO BAM GIO");
C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 12  

 676   4              Lcd_Chr(2, 6, 0 / 10 + 0x30);
 677   4              Lcd_Chr_Cp(0 % 10 + 0x30);
 678   4              Lcd_Chr_Cp(':');
 679   4              Lcd_Chr_Cp(0 / 10 + 0x30);
 680   4              Lcd_Chr_Cp(0 % 10 + 0x30);
 681   4              delay_ms1(15);
 682   4              while (mode_clock == 3)
 683   4              {
 684   5              }
 685   4              break;
 686   4            default:
 687   4              //LED = 1;
 688   4              //Delay(50000);
 689   4              break; // Error handling
 690   4            }
 691   3            if (mode_clock >= 4)
 692   3            {
 693   4              Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 694   4              Ds1307_Write_Date(Day, Date, Month, Year);
 695   4              Ds1307_Init();
 696   4              mode_clock = 0;
 697   4              break;
 698   4            }
 699   3          }
 700   2          //==================
 701   2          if (BTN_MOVE == 0)
 702   2          {
 703   3            LED = 0;
 704   3            delay_ms1(15);
 705   3            if (BTN_MOVE == 0)
 706   3            {
 707   4              if (Mode == 12)
 708   4              {
 709   5                Hour = Hour + 12;
 710   5                Mode = 24;
 711   5              }
 712   4              else
 713   4              {
 714   5                if (Hour >= 12)
 715   5                  Hour = Hour - 12;
 716   5                Mode = 12;
 717   5              }
 718   4              Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 719   4            }
 720   3            do
 721   3            {
 722   4            } while (BTN_MOVE == 0);
 723   3          }
 724   2      
 725   2          if ((Hour_setup == Hour) && (Minute_setup == Minute))
 726   2          {
 727   3            LED1 = 1;
 728   3            Delay_ngao(10000000);
 729   3            Hour_setup = 24;
 730   3            Minute_setup = 24;
 731   3          }
 732   2          else
 733   2            LED1 = 0;
 734   2          //Baothuc(Hour_setup, Minute_setup, Hour, Minute_setup);
 735   2        }
 736   1      }

C51 COMPILER V9.60.0.0   MAIN                                                              06/17/2021 23:10:56 PAGE 13  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3037    ----
   CONSTANT SIZE    =    124    ----
=======
  73          void main()
  74          {
  75   1        unsigned char Hour, Minute, Second, Mode, Day, Date, Month, Year, old_second;
  76   1        bit am_pm;
  77   1        Soft_I2c_Init();
  78   1        Ds1307_Init();
  79   1        Lcd_Init();
  80   1        count = 0;
  81   1        mode_ = 0;
  82   1        temp = 0;
  83   1        //-------------------
  84   1        //Ds1307_Write_Time(10, 10, 10, 12, 0);
  85   1        //Ds1307_Init();
  86   1        // nạp vào xong phải khởi tạo lại
  87   1      
  88   1        while (1)
  89   1        {
  90   2          //LED = 1;
  91   2          // doc va hien thi gio
  92   2          am_pm = Ds1307_Read_Time(&Hour, &Minute, &Second, &Mode);
  93   2          Ds1307_Read_Date(&Day, &Date, &Month, &Year);
  94   2          if (old_second != Second)
  95   2          {
  96   3            old_second = Second;
  97   3            if (Mode == 12)
  98   3            {
  99   4              if (am_pm == 1)
 100   4                Lcd_Out(1, 14, "PM");
 101   4              else
 102   4                Lcd_Out(1, 14, "AM");
 103   4            }
 104   3            else
 105   3              Lcd_Cmd(_LCD_CLEAR);
 106   3            print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 107   3          }
 108   2          LED = 1;
 109   2      
 110   2          if (BTN_MODE == 0)
 111   2          {
 112   3            mode_ = 1;
 113   3            Ds1307_Read_Time(&Hour, &Minute, &Second, &Mode);
 114   3            LED = 0;
 115   3            delay_ms1(15);
 116   3            do
 117   3            {
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 3   

 118   4            } while (BTN_MODE == 0);
 119   3            while (1)
 120   3            {
 121   4              if (BTN_MODE == 0)
 122   4              {
 123   5                delay_ms1(15);
 124   5                if (BTN_MODE == 0)
 125   5                  mode_ = mode_ + 1;
 126   5                do
 127   5                {
 128   6                } while (BTN_MODE == 0);
 129   5              }
 130   4              switch (mode_)
 131   4              {
 132   5              case 1:
 133   5                if (BTN_MOVE == 0)
 134   5                {
 135   6                  //Lcd_Cmd(15);
 136   6                  delay_ms1(15);
 137   6                  do
 138   6                  {
 139   7                  } while (BTN_MOVE == 0);
 140   6                  count = 1;
 141   6                  while (mode_ == 1)
 142   6                  {
 143   7                    if (BTN_MOVE == 0)
 144   7                    {
 145   8                      delay_ms1(15);
 146   8                      if (BTN_MOVE == 0)
 147   8                        count = count + 1;
 148   8                      do
 149   8                      {
 150   9                      } while (BTN_MOVE == 0);
 151   8                    }
 152   7                    switch (count)
 153   7                    {
 154   8                    case 1:
 155   8                      Lcd_Out(1, 5, "__");
 156   8                      Delay_ngao(30000);
 157   8      
 158   8                      Lcd_Chr(1, 5, Hour / 10 + 0x30);
 159   8                      Lcd_Chr_Cp(Hour % 10 + 0x30);
 160   8                      Delay_ngao(30000);
 161   8                      while (count == 1)
 162   8                      {
 163   9                        char old_hour = Hour;
 164   9                        if (BTN_MOVE == 0)
 165   9                        {
 166  10                          delay_ms1(15);
 167  10                          if (BTN_MOVE == 0)
 168  10                            count = count + 1;
 169  10                          do
 170  10                          {
 171  11                          } while (BTN_MOVE == 0);
 172  10                        }
 173   9                        else if (BTN_MODE == 0)
 174   9                        {
 175  10                          count = 0;
 176  10                          delay_ms1(15);
 177  10                          if (BTN_MODE == 0)
 178  10                            mode_ = mode_ + 1;
 179  10                          do
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 4   

 180  10                          {
 181  11                          } while (BTN_MODE == 0);
 182  10                          break;
 183  10                        }
 184   9                        else if (BTN_DOWN == 0)
 185   9                        {
 186  10                          delay_ms1(15);
 187  10                          do
 188  10                          {
 189  11                          } while (BTN_DOWN == 0);
 190  10                          if ((Hour == 0) && (Mode == 12))
 191  10                            Hour = 12;
 192  10                          if ((Hour == 0) && (Mode == 24))
 193  10                            Hour = 24;
 194  10                          Hour--;
 195  10                        }
 196   9                        else if (BTN_UP == 0)
 197   9                        {
 198  10                          delay_ms1(15);
 199  10                          do
 200  10                          {
 201  11                          } while (BTN_UP == 0);
 202  10                          if ((Hour == 11) && (Mode == 12))
 203  10                            Hour = -1;
 204  10                          if ((Hour == 23) && (Mode == 24))
 205  10                            Hour = -1;
 206  10                          Hour++;
 207  10                        }
 208   9                        if (old_hour != Hour)
 209   9                        {
 210  10                          old_hour = Hour;
 211  10                          print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 212  10                        }
 213   9                        //else
 214   9                        //{
 215   9                        // Lcd_Out(1, 5, "__");
 216   9                        // Delay_ngao(30000);
 217   9      
 218   9                        // Lcd_Chr(1, 5, Hour / 10 + 0x30);
 219   9                        // Lcd_Chr_Cp(Hour % 10 + 0x30);
 220   9                        // Delay_ngao(30000);
 221   9                        //}
 222   9                        if (count != 1)
 223   9                          break;
 224   9                      }
 225   8                      break;
 226   8                    case 2:
 227   8                      Lcd_Out(1, 8, "__");
 228   8                      Delay_ngao(30000);
 229   8      
 230   8                      Lcd_Chr(1, 8, Minute / 10 + 0x30);
 231   8                      Lcd_Chr_Cp(Minute % 10 + 0x30);
 232   8                      Delay_ngao(30000);
 233   8                      while (count == 2)
 234   8                      {
 235   9                        char old_minute = Minute;
 236   9                        if (BTN_MOVE == 0)
 237   9                        {
 238  10                          delay_ms1(15);
 239  10                          if (BTN_MOVE == 0)
 240  10                            count = count + 1;
 241  10                          do
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 5   

 242  10                          {
 243  11                          } while (BTN_MOVE == 0);
 244  10                        }
 245   9                        else if (BTN_MODE == 0)
 246   9                        {
 247  10                          count = 0;
 248  10                          delay_ms1(15);
 249  10                          if (BTN_MODE == 0)
 250  10                            mode_ = mode_ + 1;
 251  10                          do
 252  10                          {
 253  11                          } while (BTN_MODE == 0);
 254  10                          break;
 255  10                        }
 256   9                        else if (BTN_DOWN == 0)
 257   9                        {
 258  10                          delay_ms1(15);
 259  10                          do
 260  10                          {
 261  11                          } while (BTN_DOWN == 0);
 262  10                          if (Minute == 0)
 263  10                            Minute = 60;
 264  10                          Minute--;
 265  10                        }
 266   9                        else if (BTN_UP == 0)
 267   9                        {
 268  10                          delay_ms1(15);
 269  10                          do
 270  10                          {
 271  11                          } while (BTN_UP == 0);
 272  10                          if (Minute == 59)
 273  10                            Minute = -1;
 274  10                          Minute++;
 275  10                        }
 276   9                        if (old_minute != Minute)
 277   9                        {
 278  10                          old_minute = Minute;
 279  10                          print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 280  10                        }
 281   9                        // else
 282   9                        // {
 283   9                        //  Lcd_Out(1, 8, "__");
 284   9                        //  Delay_ngao(30000);
 285   9      
 286   9                        //  Lcd_Chr(1, 8, Minute / 10 + 0x30);
 287   9                        //  Lcd_Chr_Cp(Minute % 10 + 0x30);
 288   9                        //  Delay_ngao(30000);
 289   9                        // }
 290   9                        if (count != 2)
 291   9                          break;
 292   9                      }
 293   8                      break;
 294   8                    case 3:
 295   8                      Lcd_Out(1, 11, "__");
 296   8                      Delay_ngao(30000);
 297   8      
 298   8                      Lcd_Chr(1, 11, Second / 10 + 0x30);
 299   8                      Lcd_Chr_Cp(Second % 10 + 0x30);
 300   8                      Delay_ngao(30000);
 301   8                      while (count == 3)
 302   8                      {
 303   9                        char old_sec = Second;
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 6   

 304   9                        if (BTN_MOVE == 0)
 305   9                        {
 306  10                          delay_ms1(15);
 307  10                          if (BTN_MOVE == 0)
 308  10                            count = count + 1;
 309  10                          do
 310  10                          {
 311  11                          } while (BTN_MOVE == 0);
 312  10                        }
 313   9      
 314   9                        else if (BTN_MODE == 0)
 315   9                        {
 316  10                          count = 0;
 317  10                          delay_ms1(15);
 318  10                          if (BTN_MODE == 0)
 319  10                            mode_ = mode_ + 1;
 320  10                          do
 321  10                          {
 322  11                          } while (BTN_MODE == 0);
 323  10                          break;
 324  10                        }
 325   9                        else if (BTN_DOWN == 0)
 326   9                        {
 327  10                          delay_ms1(15);
 328  10                          do
 329  10                          {
 330  11                          } while (BTN_DOWN == 0);
 331  10                          if (Second == 0)
 332  10                            Second = 60;
 333  10                          Second--;
 334  10                        }
 335   9                        else if (BTN_UP == 0)
 336   9                        {
 337  10                          delay_ms1(15);
 338  10                          do
 339  10                          {
 340  11                          } while (BTN_UP == 0);
 341  10                          if (Second == 59)
 342  10                            Second = -1;
 343  10                          Second++;
 344  10                        }
 345   9                        if (old_sec != Second)
 346   9                        {
 347  10                          old_sec = Second;
 348  10                          print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 349  10                        }
 350   9                        // else
 351   9                        // {
 352   9                        //  Lcd_Out(1, 11, "__");
 353   9                        //  Delay_ngao(30000);
 354   9      
 355   9                        //  Lcd_Chr(1, 11, Second / 10 + 0x30);
 356   9                        //  Lcd_Chr_Cp(Second % 10 + 0x30);
 357   9                        //  Delay_ngao(30000);
 358   9                        // }
 359   9                        if (count != 3)
 360   9                          break;
 361   9                      }
 362   8                      break;
 363   8                    case 4:
 364   8                      Lcd_Out(2, 2, "___");
 365   8                      Delay_ngao(30000);
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 7   

 366   8      
 367   8                      Lcd_Out(2, 2, Days[Day - 1]);
 368   8                      Lcd_Chr_Cp(' ');
 369   8                      Delay_ngao(30000);
 370   8                      while (count == 4)
 371   8                      {
 372   9                        char old_day = Day;
 373   9                        if (BTN_MOVE == 0)
 374   9                        {
 375  10                          delay_ms1(15);
 376  10                          if (BTN_MOVE == 0)
 377  10                            count = count + 1;
 378  10                          do
 379  10                          {
 380  11                          } while (BTN_MOVE == 0);
 381  10                        }
 382   9                        else if (BTN_MODE == 0)
 383   9                        {
 384  10                          count = 0;
 385  10                          delay_ms1(15);
 386  10                          if (BTN_MODE == 0)
 387  10                            mode_ = mode_ + 1;
 388  10                          do
 389  10                          {
 390  11                          } while (BTN_MODE == 0);
 391  10                          break;
 392  10                        }
 393   9                        else if (BTN_DOWN == 0)
 394   9                        {
 395  10                          delay_ms1(15);
 396  10                          do
 397  10                          {
 398  11                          } while (BTN_DOWN == 0);
 399  10                          if (Day == 1)
 400  10                            Day = 8;
 401  10                          Day--;
 402  10                        }
 403   9                        else if (BTN_UP == 0)
 404   9                        {
 405  10                          delay_ms1(15);
 406  10                          do
 407  10                          {
 408  11                          } while (BTN_UP == 0);
 409  10                          if (Day == 7)
 410  10                            Day = 0;
 411  10                          Day++;
 412  10                        }
 413   9                        if (old_day != Day)
 414   9                        {
 415  10                          old_day = Day;
 416  10                          print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 417  10                        }
 418   9                        // else
 419   9                        // {
 420   9                        //  Lcd_Out(2, 2, "___");
 421   9                        //  Delay_ngao(30000);
 422   9      
 423   9                        //  Lcd_Out(2, 2, Days[Day - 1]);
 424   9                        //  Lcd_Chr_Cp(' ');
 425   9                        //  Delay_ngao(30000);
 426   9                        // }
 427   9                        if (count != 4)
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 8   

 428   9                          break;
 429   9                      }
 430   8                      break;
 431   8                    case 5:
 432   8                      Lcd_Out(2, 6, "__");
 433   8                      Delay_ngao(30000);
 434   8      
 435   8                      Lcd_Chr(2, 6, Date / 10 + 0x30);
 436   8                      Lcd_Chr_Cp(Date % 10 + 0x30);
 437   8                      Delay_ngao(30000);
 438   8                      while (count == 5)
 439   8                      {
 440   9                        char old_date = Date;
 441   9                        if (BTN_MOVE == 0)
 442   9                        {
 443  10                          delay_ms1(15);
 444  10                          if (BTN_MOVE == 0)
 445  10                            count = count + 1;
 446  10                          do
 447  10                          {
 448  11                          } while (BTN_MOVE == 0);
 449  10                        }
 450   9                        else if (BTN_MODE == 0)
 451   9                        {
 452  10                          count = 0;
 453  10                          delay_ms1(15);
 454  10                          if (BTN_MODE == 0)
 455  10                            mode_ = mode_ + 1;
 456  10                          do
 457  10                          {
 458  11                          } while (BTN_MODE == 0);
 459  10                          break;
 460  10                        }
 461   9                        else if (BTN_DOWN == 0)
 462   9                        {
 463  10                          delay_ms1(15);
 464  10                          do
 465  10                          {
 466  11                          } while (BTN_DOWN == 0);
 467  10                          if (Date == 1)
 468  10                            Date = 32;
 469  10                          Date--;
 470  10                        }
 471   9                        else if (BTN_UP == 0)
 472   9                        {
 473  10                          delay_ms1(15);
 474  10                          do
 475  10                          {
 476  11                          } while (BTN_UP == 0);
 477  10                          if (Date == 31)
 478  10                            Date = 0;
 479  10                          Date++;
 480  10                        }
 481   9                        if (old_date != Date)
 482   9                        {
 483  10                          old_date = Date;
 484  10                          print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 485  10                        }
 486   9                        // else
 487   9                        // {
 488   9                        //  Lcd_Out(2, 6, "__");
 489   9                        //  Delay_ngao(30000);
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 9   

 490   9      
 491   9                        //  Lcd_Chr(2, 6, Date / 10 + 0x30);
 492   9                        //  Lcd_Chr_Cp(Date % 10 + 0x30);
 493   9                        //  Delay_ngao(30000);
 494   9                        // }
 495   9                        if (count != 5)
 496   9                          break;
 497   9                      }
 498   8                      break;
 499   8                    case 6:
 500   8                      Lcd_Out(2, 9, "__");
 501   8                      Delay_ngao(30000);
 502   8      
 503   8                      Lcd_Chr(2, 9, Month / 10 + 0x30);
 504   8                      Lcd_Chr_Cp(Month % 10 + 0x30);
 505   8                      Delay_ngao(30000);
 506   8                      while (count == 6)
 507   8                      {
 508   9                        char old_month = Month;
 509   9                        if (BTN_MOVE == 0)
 510   9                        {
 511  10                          delay_ms1(15);
 512  10                          if (BTN_MOVE == 0)
 513  10                            count = count + 1;
 514  10                          do
 515  10                          {
 516  11                          } while (BTN_MOVE == 0);
 517  10                        }
 518   9                        else if (BTN_MODE == 0)
 519   9                        {
 520  10                          count = 0;
 521  10                          delay_ms1(15);
 522  10                          if (BTN_MODE == 0)
 523  10                            mode_ = mode_ + 1;
 524  10                          do
 525  10                          {
 526  11                          } while (BTN_MODE == 0);
 527  10                          break;
 528  10                        }
 529   9                        else if (BTN_DOWN == 0)
 530   9                        {
 531  10                          delay_ms1(15);
 532  10                          do
 533  10                          {
 534  11                          } while (BTN_DOWN == 0);
 535  10                          if (Month == 1)
 536  10                            Month = 13;
 537  10                          Month--;
 538  10                        }
 539   9                        else if (BTN_UP == 0)
 540   9                        {
 541  10                          delay_ms1(15);
 542  10                          do
 543  10                          {
 544  11                          } while (BTN_UP == 0);
 545  10                          if (Month == 12)
 546  10                            Month = 0;
 547  10                          Month++;
 548  10                        }
 549   9                        if (old_month != Month)
 550   9                        {
 551  10                          old_month = Month;
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 10  

 552  10                          print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 553  10                        }
 554   9                        // else
 555   9                        // {
 556   9                        //  Lcd_Out(2, 9, "__");
 557   9                        //  Delay_ngao(30000);
 558   9      
 559   9                        //  Lcd_Chr(2, 9, Month / 10 + 0x30);
 560   9                        //  Lcd_Chr_Cp(Month % 10 + 0x30);
 561   9                        //  Delay_ngao(30000);
 562   9                        // }
 563   9                        if (count != 6)
 564   9                          break;
 565   9                      }
 566   8                      break;
 567   8                    case 7:
 568   8                      Lcd_Out(2, 12, "____");
 569   8                      Delay_ngao(30000);
 570   8                      Lcd_Out(2, 12, "20");
 571   8                      Lcd_Chr_Cp(Year / 10 + 0x30);
 572   8                      Lcd_Chr_Cp(Year % 10 + 0x30);
 573   8                      Delay_ngao(30000);
 574   8                      while (count == 7)
 575   8                      {
 576   9                        char old_year = Year;
 577   9                        if (BTN_MOVE == 0)
 578   9                        {
 579  10                          delay_ms1(15);
 580  10                          if (BTN_MOVE == 0)
 581  10                            count = count + 1;
 582  10                          do
 583  10                          {
 584  11                          } while (BTN_MOVE == 0);
 585  10                        }
 586   9                        else if (BTN_MODE == 0)
 587   9                        {
 588  10                          count = 0;
 589  10                          delay_ms1(15);
 590  10                          if (BTN_MODE == 0)
 591  10                            mode_ = mode_ + 1;
 592  10                          do
 593  10                          {
 594  11                          } while (BTN_MODE == 0);
 595  10                          break;
 596  10                        }
 597   9                        else if (BTN_DOWN == 0)
 598   9                        {
 599  10                          delay_ms1(15);
 600  10                          do
 601  10                          {
 602  11                          } while (BTN_DOWN == 0);
 603  10                          Year--;
 604  10                        }
 605   9                        else if (BTN_UP == 0)
 606   9                        {
 607  10                          delay_ms1(15);
 608  10                          do
 609  10                          {
 610  11                          } while (BTN_UP == 0);
 611  10                          Year++;
 612  10                        }
 613   9                        if (old_year != Year)
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 11  

 614   9                        {
 615  10                          old_year = Year;
 616  10                          print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 617  10                        }
 618   9                        // else
 619   9                        // {
 620   9                        //  Lcd_Out(2, 12, "____");
 621   9                        //  Delay_ngao(30000);
 622   9                        //  Lcd_Out(2, 12, "20");
 623   9                        //  Lcd_Chr_Cp(Year / 10 + 0x30);
 624   9                        //  Lcd_Chr_Cp(Year % 10 + 0x30);
 625   9                        //  Delay_ngao(30000);
 626   9                        // }
 627   9                        if (count != 7)
 628   9                          break;
 629   9                      }
 630   8                      break;
 631   8                    default:
 632   8                      //LED = 1;
 633   8                      //Delay(50000);
 634   8                      break; // Error handling
 635   8                    }
 636   7                    if (count >= 8)
 637   7                    {
 638   8                      Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 639   8                      Ds1307_Write_Date(Day, Date, Month, Year);
 640   8                      Ds1307_Init();
 641   8                      break;
 642   8                    }
 643   7                  }
 644   6                  if (mode_ != 1)
 645   6                    break;
 646   6                }
 647   5                break;
 648   5              case 2:
 649   5                Lcd_Cmd(1);
 650   5                Lcd_Out(1, 1, "CAI DAT BAO THUC");
 651   5                Lcd_Chr(2, 6, 0 / 10 + 0x30);
 652   5                Lcd_Chr_Cp(0 % 10 + 0x30);
 653   5                Lcd_Chr_Cp(':');
 654   5                Lcd_Chr_Cp(0 / 10 + 0x30);
 655   5                Lcd_Chr_Cp(0 % 10 + 0x30);
 656   5                delay_ms1(15);
 657   5                if (BTN_MOVE == 0)
 658   5                {
 659   6                  // Lcd_Cmd(1);
 660   6                  // Lcd_Out(1, 1, "CAI DAT BAO THUC");
 661   6                  // Lcd_Chr(2, 6, 0 / 10 + 0x30);
 662   6                  // Lcd_Chr_Cp(0 % 10 + 0x30);
 663   6                  // Lcd_Chr_Cp(':');
 664   6                  // Lcd_Chr_Cp(0 / 10 + 0x30);
 665   6                  // Lcd_Chr_Cp(0 % 10 + 0x30);
 666   6                  delay_ms1(15);
 667   6                  temp = 1;
 668   6                  do
 669   6                  {
 670   7                  } while (BTN_MOVE == 0);
 671   6                  Hour_setup = 24;
 672   6                  Minute_setup = 24;
 673   6                  while (mode_ == 2)
 674   6                  {
 675   7                    if (BTN_MOVE == 0)
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 12  

 676   7                    {
 677   8                      delay_ms1(15);
 678   8                      if (BTN_MOVE == 0)
 679   8                        temp = temp + 1;
 680   8                      do
 681   8                      {
 682   9                      } while (BTN_MOVE == 0);
 683   8                    }
 684   7      
 685   7                    switch (temp)
 686   7                    {
 687   8                    case 1:
 688   8                      Lcd_Out(2, 6, "__");
 689   8                      Lcd_Chr_Cp(':');
 690   8                      Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 691   8                      Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 692   8                      Delay_ngao(30000);
 693   8      
 694   8                      Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 695   8                      Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 696   8                      Lcd_Chr_Cp(':');
 697   8                      Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 698   8                      Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 699   8                      Delay_ngao(30000);
 700   8                      Lcd_Out(1, 1, "CAI DAT BAO THUC");
 701   8                      while (temp == 1)
 702   8                      {
 703   9                        char old_Hour_setup = Hour_setup;
 704   9                        if (BTN_MOVE == 0)
 705   9                        {
 706  10                          delay_ms1(15);
 707  10                          if (BTN_MOVE == 0)
 708  10                            temp = temp + 1;
 709  10                          do
 710  10                          {
 711  11                          } while (BTN_MOVE == 0);
 712  10                        }
 713   9                        else if (BTN_MODE == 0)
 714   9                        {
 715  10                          temp = 0;
 716  10                          delay_ms1(15);
 717  10                          if (BTN_MODE == 0)
 718  10                            mode_ = mode_ + 1;
 719  10                          do
 720  10                          {
 721  11                          } while (BTN_MODE == 0);
 722  10                          break;
 723  10                        }
 724   9                        else if (BTN_DOWN == 0)
 725   9                        {
 726  10                          delay_ms1(15);
 727  10                          do
 728  10                          {
 729  11                          } while (BTN_DOWN == 0);
 730  10                          if ((Hour_setup == 0) && (Mode == 12))
 731  10                            Hour_setup = 12;
 732  10                          if ((Hour_setup == 0) && (Mode == 24))
 733  10                            Hour_setup = 24;
 734  10                          Hour_setup--;
 735  10                        }
 736   9                        else if (BTN_UP == 0)
 737   9                        {
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 13  

 738  10                          delay_ms1(15);
 739  10                          do
 740  10                          {
 741  11                          } while (BTN_UP == 0);
 742  10                          if ((Hour_setup == 11) && (Mode == 12))
 743  10                            Hour_setup = -1;
 744  10                          if ((Hour_setup == 23) && (Mode == 24))
 745  10                            Hour_setup = -1;
 746  10                          Hour_setup++;
 747  10                        }
 748   9                        if (old_Hour_setup != Hour_setup)
 749   9                        {
 750  10                          old_Hour_setup = Hour_setup;
 751  10                          Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 752  10                          Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 753  10                          Lcd_Chr_Cp(':');
 754  10                          Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 755  10                          Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 756  10                        }
 757   9                        // else
 758   9                        // {
 759   9                        //  Lcd_Out(2, 6, "__");
 760   9                        //  Lcd_Chr_Cp(':');
 761   9                        //  Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 762   9                        //  Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 763   9                        //  Delay_ngao(30000);
 764   9      
 765   9                        //  Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 766   9                        //  Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 767   9                        //  Lcd_Chr_Cp(':');
 768   9                        //  Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 769   9                        //  Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 770   9                        //  Delay_ngao(30000);
 771   9                        // }
 772   9                        // if (temp != 1)
 773   9                        //  break;
 774   9                      }
 775   8                      break;
 776   8                    case 2:
 777   8                      Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 778   8                      Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 779   8                      Lcd_Chr_Cp(':');
 780   8                      Lcd_Out(2, 9, "__");
 781   8                      Delay_ngao(30000);
 782   8      
 783   8                      Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 784   8                      Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 785   8                      Lcd_Chr_Cp(':');
 786   8                      Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 787   8                      Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 788   8                      Delay_ngao(30000);
 789   8                      Lcd_Out(1, 1, "CAI DAT BAO THUC");
 790   8                      while (temp == 2)
 791   8                      {
 792   9                        char old_Minute_setup = Minute_setup;
 793   9                        if (BTN_MOVE == 0)
 794   9                        {
 795  10                          delay_ms1(15);
 796  10                          if (BTN_MOVE == 0)
 797  10                            temp = temp + 1;
 798  10                          do
 799  10                          {
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 14  

 800  11                          } while (BTN_MOVE == 0);
 801  10                        }
 802   9                        else if (BTN_MODE == 0)
 803   9                        {
 804  10                          temp = 0;
 805  10                          delay_ms1(15);
 806  10                          if (BTN_MODE == 0)
 807  10                            mode_ = mode_ + 1;
 808  10                          do
 809  10                          {
 810  11                          } while (BTN_MODE == 0);
 811  10                          break;
 812  10                        }
 813   9                        else if (BTN_DOWN == 0)
 814   9                        {
 815  10                          delay_ms1(15);
 816  10                          do
 817  10                          {
 818  11                          } while (BTN_DOWN == 0);
 819  10                          if (Minute_setup == 0)
 820  10                            Minute_setup = 60;
 821  10                          Minute_setup--;
 822  10                        }
 823   9                        else if (BTN_UP == 0)
 824   9                        {
 825  10                          delay_ms1(15);
 826  10                          do
 827  10                          {
 828  11                          } while (BTN_UP == 0);
 829  10                          if (Minute_setup == 59)
 830  10                            Minute_setup = -1;
 831  10                          Minute_setup++;
 832  10                        }
 833   9                        if (old_Minute_setup != Minute_setup)
 834   9                        {
 835  10                          old_Minute_setup = Minute_setup;
 836  10                          Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 837  10                          Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 838  10                          Lcd_Chr_Cp(':');
 839  10                          Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 840  10                          Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 841  10                        }
 842   9                        // else
 843   9                        // {
 844   9                        //  Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 845   9                        //  Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 846   9                        //  Lcd_Chr_Cp(':');
 847   9                        //  Lcd_Out(2, 9, "__");
 848   9                        //  Delay_ngao(30000);
 849   9      
 850   9                        //  Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 851   9                        //  Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 852   9                        //  Lcd_Chr_Cp(':');
 853   9                        //  Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 854   9                        //  Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 855   9                        //  Delay_ngao(30000);
 856   9                        // }
 857   9                        if (temp != 2)
 858   9                        {
 859  10                          Lcd_Cmd(1);
 860  10                          break;
 861  10                        }
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 15  

 862   9                      }
 863   8                      break;
 864   8                    default:
 865   8                      break;
 866   8                    }
 867   7                    if (temp >= 3)
 868   7                      break;
 869   7                  }
 870   6                  if (mode_ > 2)
 871   6                    break;
 872   6                }
 873   5                break;
 874   5              default:
 875   5                //LED = 1;
 876   5                //Delay(50000);
 877   5                break; // Error handling
 878   5              }
 879   4              if (mode_ > 2)
 880   4                break;
 881   4            }
 882   3          }
 883   2          if (BTN_MOVE == 0)
 884   2          {
 885   3            LED = 0;
 886   3            delay_ms1(15);
 887   3            if (BTN_MOVE == 0)
 888   3            {
 889   4              if (Mode == 12)
 890   4                Mode = 24;
 891   4              else
 892   4                Mode = 12;
 893   4              if (Hour >= 12)
 894   4                Hour = Hour - 12;
 895   4              Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 896   4            }
 897   3            do
 898   3            {
 899   4            } while (BTN_MOVE == 0);
 900   3          }
 901   2          if ((Hour_setup == Hour) && (Minute_setup == Minute))
 902   2          {
 903   3            LED1 = 1;
 904   3            Delay_ngao(10000000);
 905   3            Hour_setup = 24;
 906   3            Minute_setup = 24;
 907   3          }
 908   2          else
 909   2            LED1 = 0;
 910   2          //Baothuc(Hour_setup, Minute_setup, Hour, Minute_setup);
 911   2        }
 912   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3179    ----
   CONSTANT SIZE    =    108    ----
>>>>>>> 3ee300c1f9e4dad49057a9c8ba7e4389ff8675df
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10      21
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
   EDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2021 22:41:46 PAGE 16  

   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
