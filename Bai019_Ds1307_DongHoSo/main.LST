C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          #include "main.h"
   2          #include "..\lib\Soft_I2c.h"
   3          #include "..\lib\Lcd4.h"
   4          #include "..\lib\Rtc_Ds1307.h"
   5          #include "Port.h"
   6          
   7          #define LED P2_1
   8          #define LED1 P3_7
   9          
  10          unsigned char *code Days[] = {"SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"};
  11          
  12          void delay_ms1(unsigned int time)
  13          {
  14   1        unsigned int x, y;
  15   1        for (x = 0; x < time; x++)
  16   1          for (y = 0; y < 125; y++)
  17   1          {
  18   2          }
  19   1      }
  20          
  21          void delay_ms_CL(int ms)
  22          {
  23   1        while (ms--)
  24   1        {
  25   2          TMOD = 0x01;
  26   2          TH0 = 0xfc;
  27   2          TL0 = 0x18;
  28   2          TR0 = 1;
  29   2          while (!TF0)
  30   2            ;
  31   2          TF0 = 0;
  32   2          TR0 = 0;
  33   2        }
  34   1      }
  35          
  36          void timer_delay() /* Timer0 delay function */
  37          {
  38   1        TH0 = 0xFC; /* Load higher 8-bit in TH0 */
  39   1        TL0 = 0x74; /* Load lower 8-bit in TL0 */
  40   1        TR0 = 1;  /* Start timer0 */
  41   1        while (TF0 == 0)
  42   1          ;  /* Wait until timer0 flag set */
  43   1        TR0 = 0; /* Stop timer0 */
  44   1        TF0 = 0; /* Clear timer0 flag */
  45   1      }
  46          
  47          unsigned int count;
  48          unsigned int mode_clock;
  49          unsigned int temp;
  50          unsigned int Hour_setup;
  51          unsigned int Minute_setup;
  52          unsigned int demc;
  53          unsigned int hi;
  54          
  55          void Delay_ngao(unsigned int Time)
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 2   

  56          {
  57   1        while (Time--)
  58   1          ;
  59   1      }
  60          //-----------------
  61          void print_LCD(unsigned char Hour,
  62                   unsigned char Minute,
  63                   unsigned char Second,
  64                   unsigned char Day,
  65                   unsigned char Date,
  66                   unsigned char Month,
  67                   unsigned char Year)
  68          {
  69   1        Lcd_Chr(1, 5, Hour / 10 + 0x30);
  70   1        Lcd_Chr_Cp(Hour % 10 + 0x30);
  71   1        Lcd_Chr_Cp(':');
  72   1        Lcd_Chr_Cp(Minute / 10 + 0x30);
  73   1        Lcd_Chr_Cp(Minute % 10 + 0x30);
  74   1        Lcd_Chr_Cp(':');
  75   1        Lcd_Chr_Cp(Second / 10 + 0x30);
  76   1        Lcd_Chr_Cp(Second % 10 + 0x30);
  77   1        Lcd_Out(2, 1, "                ");
  78   1        Lcd_Out(2, 2, Days[Day - 1]);
  79   1        Lcd_Chr_Cp(' ');
  80   1        Lcd_Chr_Cp(Date / 10 + 0x30);
  81   1        Lcd_Chr_Cp(Date % 10 + 0x30);
  82   1        Lcd_Chr_Cp('/');
  83   1        Lcd_Chr_Cp(Month / 10 + 0x30);
  84   1        Lcd_Chr_Cp(Month % 10 + 0x30);
  85   1        Lcd_Out_Cp("/20");
  86   1        Lcd_Chr_Cp(Year / 10 + 0x30);
  87   1        Lcd_Chr_Cp(Year % 10 + 0x30);
  88   1      }
  89          
  90          void Baothuc(unsigned char Hour_setup,
  91                 unsigned char Minute_setup,
  92                 unsigned char Hour,
  93                 unsigned char Minute)
  94          {
  95   1        if (Hour_setup == Hour)
  96   1          if (Minute_setup == Minute)
  97   1            LED1 = 1;
  98   1          else
  99   1            LED1 = 0;
 100   1      }
 101          
 102          void Up(void) interrupt 0 //Khai báo trình phục vụ ngắt ngoài 1
 103          {
 104   1        mode_clock++;
 105   1      }
 106          
 107          void main()
 108          {
 109   1        unsigned char Hour, Minute, Second, Mode, Day, Date, Month, Year, old_second;
 110   1        unsigned char Hou_CL, Minute_CL, Second_CL;
 111   1        bit am_pm;
 112   1        BTN_MODE = 1;
 113   1        EA = 1;
 114   1        IT0 = 1;
 115   1        EX0 = 1;
 116   1        Soft_I2c_Init();
 117   1        Ds1307_Init();
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 3   

 118   1        Lcd_Init();
 119   1        mode_clock = 0;
 120   1        count = 0;
 121   1        temp = 0;
 122   1        Hou_CL = 0;
 123   1        Minute_CL = 0;
 124   1        Second_CL = 0;
 125   1        TMOD = 0x01;
 126   1        //-------------------
 127   1        //Ds1307_Write_Time(10, 10, 10, 12, 0);
 128   1        //Ds1307_Init();
 129   1        // nạp vào xong phải khởi tạo lại
 130   1      
 131   1        while (1)
 132   1        {
 133   2          //LED = 1;
 134   2          // doc va hien thi gio
 135   2          am_pm = Ds1307_Read_Time(&Hour, &Minute, &Second, &Mode);
 136   2          Ds1307_Read_Date(&Day, &Date, &Month, &Year);
 137   2          if (old_second != Second)
 138   2          {
 139   3            old_second = Second;
 140   3            if (Mode == 12)
 141   3            {
 142   4              if (am_pm == 1)
 143   4                Lcd_Out(1, 14, "PM");
 144   4              else
 145   4                Lcd_Out(1, 14, "AM");
 146   4            }
 147   3            else
 148   3              Lcd_Cmd(_LCD_CLEAR);
 149   3            print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 150   3          }
 151   2          LED = 0;
 152   2      
 153   2          //Lcd_Cmd(15);
 154   2          while (mode_clock > 0)
 155   2          {
 156   3            LED = 1;
 157   3            switch (mode_clock)
 158   3            {
 159   4            case 1:
 160   4              Lcd_Out(1, 11, "  ");
 161   4              timer_delay();
 162   4      
 163   4              Lcd_Chr(1, 11, Second / 10 + 0x30);
 164   4              Lcd_Chr_Cp(Second % 10 + 0x30);
 165   4              timer_delay();
 166   4              if (BTN_MOVE == 0)
 167   4              {
 168   5                //Lcd_Cmd(15);
 169   5                delay_ms1(15);
 170   5                do
 171   5                {
 172   6                } while (BTN_MOVE == 0);
 173   5                count = 1;
 174   5                while (mode_clock == 1)
 175   5                {
 176   6                  if (BTN_MOVE == 0)
 177   6                  {
 178   7                    delay_ms1(15);
 179   7                    if (BTN_MOVE == 0)
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 4   

 180   7                      count = count + 1;
 181   7                    do
 182   7                    {
 183   8                    } while (BTN_MOVE == 0);
 184   7                  }
 185   6                  switch (count)
 186   6                  {
 187   7                  case 2:
 188   7                    while (count == 2 && mode_clock == 1)
 189   7                    {
 190   8                      char old_hour = Hour;
 191   8                      if (BTN_MOVE == 0)
 192   8                      {
 193   9                        delay_ms1(15);
 194   9                        if (BTN_MOVE == 0)
 195   9                          count = count + 1;
 196   9                        do
 197   9                        {
 198  10                        } while (BTN_MOVE == 0);
 199   9                      }
 200   8                      else if (BTN_DOWN == 0)
 201   8                      {
 202   9                        delay_ms1(15);
 203   9                        do
 204   9                        {
 205  10                        } while (BTN_DOWN == 0);
 206   9                        if ((Hour == 0) && (Mode == 12))
 207   9                          Hour = 12;
 208   9                        if ((Hour == 0) && (Mode == 24))
 209   9                          Hour = 24;
 210   9                        Hour--;
 211   9                      }
 212   8                      else if (BTN_UP == 0)
 213   8                      {
 214   9                        delay_ms1(15);
 215   9                        do
 216   9                        {
 217  10                        } while (BTN_UP == 0);
 218   9                        if ((Hour == 11) && (Mode == 12))
 219   9                          Hour = -1;
 220   9                        if ((Hour == 23) && (Mode == 24))
 221   9                          Hour = -1;
 222   9                        Hour++;
 223   9                      }
 224   8                      else
 225   8                      {
 226   9                        Lcd_Out(1, 5, "  ");
 227   9                        timer_delay();
 228   9      
 229   9                        Lcd_Chr(1, 5, Hour / 10 + 0x30);
 230   9                        Lcd_Chr_Cp(Hour % 10 + 0x30);
 231   9                        timer_delay();
 232   9                      }
 233   8                      if (old_hour != Hour)
 234   8                      {
 235   9                        old_hour = Hour;
 236   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 237   9                      }
 238   8                      if (count != 2)
 239   8                        break;
 240   8                    }
 241   7                    break;
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 5   

 242   7                  case 1:
 243   7                    while (count == 1 && mode_clock == 1)
 244   7                    {
 245   8                      char old_minute = Minute;
 246   8                      if (BTN_MOVE == 0)
 247   8                      {
 248   9                        delay_ms1(15);
 249   9                        if (BTN_MOVE == 0)
 250   9                          count = count + 1;
 251   9                        do
 252   9                        {
 253  10                        } while (BTN_MOVE == 0);
 254   9                      }
 255   8                      else if (BTN_DOWN == 0)
 256   8                      {
 257   9                        delay_ms1(15);
 258   9                        do
 259   9                        {
 260  10                        } while (BTN_DOWN == 0);
 261   9                        if (Minute == 0)
 262   9                          Minute = 60;
 263   9                        Minute--;
 264   9                      }
 265   8                      else if (BTN_UP == 0)
 266   8                      {
 267   9                        delay_ms1(15);
 268   9                        do
 269   9                        {
 270  10                        } while (BTN_UP == 0);
 271   9                        if (Minute == 59)
 272   9                          Minute = -1;
 273   9                        Minute++;
 274   9                      }
 275   8                      else
 276   8                      {
 277   9                        Lcd_Out(1, 8, "  ");
 278   9                        timer_delay();
 279   9      
 280   9                        Lcd_Chr(1, 8, Minute / 10 + 0x30);
 281   9                        Lcd_Chr_Cp(Minute % 10 + 0x30);
 282   9                        timer_delay();
 283   9                      }
 284   8                      if (old_minute != Minute)
 285   8                      {
 286   9                        old_minute = Minute;
 287   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 288   9                      }
 289   8                      if (count != 1)
 290   8                        break;
 291   8                    }
 292   7                    break;
 293   7                  // case 3:
 294   7                  //  Lcd_Out(1, 11, "__");
 295   7                  //  Delay_ngao(30000);
 296   7      
 297   7                  //  Lcd_Chr(1, 11, Second / 10 + 0x30);
 298   7                  //  Lcd_Chr_Cp(Second % 10 + 0x30);
 299   7                  //  Delay_ngao(30000);
 300   7                  //  while (count == 3 && mode_clock == 1)
 301   7                  //  {
 302   7                  //    char old_sec = Second;
 303   7                  //    if (BTN_MOVE == 0)
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 6   

 304   7                  //    {
 305   7                  //      delay_ms1(15);
 306   7                  //      if (BTN_MOVE == 0)
 307   7                  //        count = count + 1;
 308   7                  //      do
 309   7                  //      {
 310   7                  //      } while (BTN_MOVE == 0);
 311   7                  //    }
 312   7                  //    else if (BTN_DOWN == 0)
 313   7                  //    {
 314   7                  //      delay_ms1(15);
 315   7                  //      do
 316   7                  //      {
 317   7                  //      } while (BTN_DOWN == 0);
 318   7                  //      if (Second == 0)
 319   7                  //        Second = 60;
 320   7                  //      Second--;
 321   7                  //    }
 322   7                  //    else if (BTN_UP == 0)
 323   7                  //    {
 324   7                  //      delay_ms1(15);
 325   7                  //      do
 326   7                  //      {
 327   7                  //      } while (BTN_UP == 0);
 328   7                  //      if (Second == 59)
 329   7                  //        Second = -1;
 330   7                  //      Second++;
 331   7                  //    }
 332   7                  //    if (old_sec != Second)
 333   7                  //    {
 334   7                  //      old_sec = Second;
 335   7                  //      print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 336   7                  //    }
 337   7                  //    if (count != 3)
 338   7                  //      break;
 339   7                  //  }
 340   7                  //  break;
 341   7                  case 3:
 342   7                    while (count == 3 && mode_clock == 1)
 343   7                    {
 344   8                      char old_day = Day;
 345   8                      if (BTN_MOVE == 0)
 346   8                      {
 347   9                        delay_ms1(15);
 348   9                        if (BTN_MOVE == 0)
 349   9                          count = count + 1;
 350   9                        do
 351   9                        {
 352  10                        } while (BTN_MOVE == 0);
 353   9                      }
 354   8                      else if (BTN_DOWN == 0)
 355   8                      {
 356   9                        delay_ms1(15);
 357   9                        do
 358   9                        {
 359  10                        } while (BTN_DOWN == 0);
 360   9                        if (Day == 1)
 361   9                          Day = 8;
 362   9                        Day--;
 363   9                      }
 364   8                      else if (BTN_UP == 0)
 365   8                      {
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 7   

 366   9                        delay_ms1(15);
 367   9                        do
 368   9                        {
 369  10                        } while (BTN_UP == 0);
 370   9                        if (Day == 7)
 371   9                          Day = 0;
 372   9                        Day++;
 373   9                      }
 374   8                      else
 375   8                      {
 376   9                        Lcd_Out(2, 2, "   ");
 377   9                        timer_delay();
 378   9      
 379   9                        Lcd_Out(2, 2, Days[Day - 1]);
 380   9                        Lcd_Chr_Cp(' ');
 381   9                        timer_delay();
 382   9                      }
 383   8                      if (old_day != Day)
 384   8                      {
 385   9                        old_day = Day;
 386   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 387   9                      }
 388   8                      if (count != 3)
 389   8                        break;
 390   8                    }
 391   7                    break;
 392   7                  case 4:
 393   7                    while (count == 4 && mode_clock == 1)
 394   7                    {
 395   8                      char old_date = Date;
 396   8                      if (BTN_MOVE == 0)
 397   8                      {
 398   9                        delay_ms1(15);
 399   9                        if (BTN_MOVE == 0)
 400   9                          count = count + 1;
 401   9                        do
 402   9                        {
 403  10                        } while (BTN_MOVE == 0);
 404   9                      }
 405   8                      else if (BTN_DOWN == 0)
 406   8                      {
 407   9                        delay_ms1(15);
 408   9                        do
 409   9                        {
 410  10                        } while (BTN_DOWN == 0);
 411   9                        if (Date == 1)
 412   9                          Date = 32;
 413   9                        Date--;
 414   9                      }
 415   8                      else if (BTN_UP == 0)
 416   8                      {
 417   9                        delay_ms1(15);
 418   9                        do
 419   9                        {
 420  10                        } while (BTN_UP == 0);
 421   9                        if (Date == 31)
 422   9                          Date = 0;
 423   9                        Date++;
 424   9                      }
 425   8                      else
 426   8                      {
 427   9                        Lcd_Out(2, 6, "  ");
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 8   

 428   9                        timer_delay();
 429   9      
 430   9                        Lcd_Chr(2, 6, Date / 10 + 0x30);
 431   9                        Lcd_Chr_Cp(Date % 10 + 0x30);
 432   9                        timer_delay();
 433   9                      }
 434   8                      if (old_date != Date)
 435   8                      {
 436   9                        old_date = Date;
 437   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 438   9                      }
 439   8                      if (count != 4)
 440   8                        break;
 441   8                    }
 442   7                    break;
 443   7                  case 5:
 444   7                    while (count == 5 && mode_clock == 1)
 445   7                    {
 446   8                      char old_month = Month;
 447   8                      if (BTN_MOVE == 0)
 448   8                      {
 449   9                        delay_ms1(15);
 450   9                        if (BTN_MOVE == 0)
 451   9                          count = count + 1;
 452   9                        do
 453   9                        {
 454  10                        } while (BTN_MOVE == 0);
 455   9                      }
 456   8                      else if (BTN_DOWN == 0)
 457   8                      {
 458   9                        delay_ms1(15);
 459   9                        do
 460   9                        {
 461  10                        } while (BTN_DOWN == 0);
 462   9                        if (Month == 1)
 463   9                          Month = 13;
 464   9                        Month--;
 465   9                      }
 466   8                      else if (BTN_UP == 0)
 467   8                      {
 468   9                        delay_ms1(15);
 469   9                        do
 470   9                        {
 471  10                        } while (BTN_UP == 0);
 472   9                        if (Month == 12)
 473   9                          Month = 0;
 474   9                        Month++;
 475   9                      }
 476   8                      else
 477   8                      {
 478   9                        Lcd_Out(2, 9, "  ");
 479   9                        timer_delay();
 480   9      
 481   9                        Lcd_Chr(2, 9, Month / 10 + 0x30);
 482   9                        Lcd_Chr_Cp(Month % 10 + 0x30);
 483   9                        timer_delay();
 484   9                      }
 485   8                      if (old_month != Month)
 486   8                      {
 487   9                        old_month = Month;
 488   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 489   9                      }
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 9   

 490   8                      if (count != 5)
 491   8                        break;
 492   8                    }
 493   7                    break;
 494   7                  case 6:
 495   7                    while (count == 6 && mode_clock == 1)
 496   7                    {
 497   8                      char old_year = Year;
 498   8                      if (BTN_MOVE == 0)
 499   8                      {
 500   9                        delay_ms1(15);
 501   9                        if (BTN_MOVE == 0)
 502   9                          count = count + 1;
 503   9                        do
 504   9                        {
 505  10                        } while (BTN_MOVE == 0);
 506   9                      }
 507   8                      else if (BTN_DOWN == 0)
 508   8                      {
 509   9                        delay_ms1(15);
 510   9                        do
 511   9                        {
 512  10                        } while (BTN_DOWN == 0);
 513   9                        Year--;
 514   9                      }
 515   8                      else if (BTN_UP == 0)
 516   8                      {
 517   9                        delay_ms1(15);
 518   9                        do
 519   9                        {
 520  10                        } while (BTN_UP == 0);
 521   9                        Year++;
 522   9                      }
 523   8                      else
 524   8                      {
 525   9                        Lcd_Out(2, 12, "    ");
 526   9                        timer_delay();
 527   9                        Lcd_Out(2, 12, "20");
 528   9                        Lcd_Chr(2, 14, Year / 10 + 0x30);
 529   9                        //Lcd_Chr_Cp(Year / 10 + 0x30);
 530   9                        Lcd_Chr_Cp(Year % 10 + 0x30);
 531   9                        timer_delay();
 532   9                      }
 533   8                      if (old_year != Year)
 534   8                      {
 535   9                        old_year = Year;
 536   9                        print_LCD(Hour, Minute, Second, Day, Date, Month, Year);
 537   9                      }
 538   8                      if (count != 6)
 539   8                        break;
 540   8                    }
 541   7                    break;
 542   7                  default:
 543   7                    break; // Error handling
 544   7                  }
 545   6                  if (count >= 7)
 546   6                  {
 547   7                    mode_clock++;
 548   7                    // Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 549   7                    // Ds1307_Write_Date(Day, Date, Month, Year);
 550   7                    // Ds1307_Init();
 551   7                    break;
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 10  

 552   7                  }
 553   6                }
 554   5                if (mode_clock != 1)
 555   5                  break;
 556   5              }
 557   4              break;
 558   4              //while(mode_clock == 1){}
 559   4            case 2:
 560   4              Lcd_Cmd(1);
 561   4              Lcd_Out(1, 1, "CAI DAT BAO THUC");
 562   4              delay_ms1(15);
 563   4              if (BTN_MOVE == 0)
 564   4              {
 565   5                // Lcd_Cmd(1);
 566   5                // Lcd_Out(1, 1, "CAI DAT BAO THUC");
 567   5                // Lcd_Chr(2, 6, 0 / 10 + 0x30);
 568   5                // Lcd_Chr_Cp(0 % 10 + 0x30);
 569   5                // Lcd_Chr_Cp(':');
 570   5                // Lcd_Chr_Cp(0 / 10 + 0x30);
 571   5                // Lcd_Chr_Cp(0 % 10 + 0x30);
 572   5                delay_ms1(15);
 573   5                temp = 1;
 574   5                do
 575   5                {
 576   6                } while (BTN_MOVE == 0);
 577   5                Hour_setup = 0;
 578   5                Minute_setup = 0;
 579   5                while (mode_clock == 2)
 580   5                {
 581   6                  if (BTN_MOVE == 0)
 582   6                  {
 583   7                    delay_ms1(15);
 584   7                    if (BTN_MOVE == 0)
 585   7                      temp = temp + 1;
 586   7                    do
 587   7                    {
 588   8                    } while (BTN_MOVE == 0);
 589   7                  }
 590   6      
 591   6                  switch (temp)
 592   6                  {
 593   7                  case 1:
 594   7                    Lcd_Out(2, 6, "  ");
 595   7                    Lcd_Chr_Cp(':');
 596   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 597   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 598   7                    Delay_ngao(30000);
 599   7      
 600   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 601   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 602   7                    Lcd_Chr_Cp(':');
 603   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 604   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 605   7                    Delay_ngao(30000);
 606   7                    Lcd_Out(1, 1, "CAI DAT BAO THUC");
 607   7                    while (temp == 1 && mode_clock == 2)
 608   7                    {
 609   8                      char old_Hour_setup = Hour_setup;
 610   8                      if (BTN_MOVE == 0)
 611   8                      {
 612   9                        delay_ms1(15);
 613   9                        if (BTN_MOVE == 0)
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 11  

 614   9                          temp = temp + 1;
 615   9                        do
 616   9                        {
 617  10                        } while (BTN_MOVE == 0);
 618   9                      }
 619   8                      else if (BTN_DOWN == 0)
 620   8                      {
 621   9                        delay_ms1(15);
 622   9                        do
 623   9                        {
 624  10                        } while (BTN_DOWN == 0);
 625   9                        if ((Hour_setup == 0) && (Mode == 12))
 626   9                          Hour_setup = 12;
 627   9                        if ((Hour_setup == 0) && (Mode == 24))
 628   9                          Hour_setup = 24;
 629   9                        Hour_setup--;
 630   9                      }
 631   8                      else if (BTN_UP == 0)
 632   8                      {
 633   9                        delay_ms1(15);
 634   9                        do
 635   9                        {
 636  10                        } while (BTN_UP == 0);
 637   9                        if ((Hour_setup == 11) && (Mode == 12))
 638   9                          Hour_setup = -1;
 639   9                        if ((Hour_setup == 23) && (Mode == 24))
 640   9                          Hour_setup = -1;
 641   9                        Hour_setup++;
 642   9                      }
 643   8                      else
 644   8                      {
 645   9                        Lcd_Out(2, 6, "  ");
 646   9                        Lcd_Chr_Cp(':');
 647   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 648   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 649   9                        timer_delay();
 650   9      
 651   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 652   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 653   9                        Lcd_Chr_Cp(':');
 654   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 655   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 656   9                        timer_delay();
 657   9                      }
 658   8                      if (old_Hour_setup != Hour_setup)
 659   8                      {
 660   9                        old_Hour_setup = Hour_setup;
 661   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 662   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 663   9                        Lcd_Chr_Cp(':');
 664   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 665   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 666   9                      }
 667   8                    }
 668   7                    break;
 669   7                  case 2:
 670   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 671   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 672   7                    Lcd_Chr_Cp(':');
 673   7                    Lcd_Out(2, 9, "  ");
 674   7                    Delay_ngao(30000);
 675   7      
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 12  

 676   7                    Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 677   7                    Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 678   7                    Lcd_Chr_Cp(':');
 679   7                    Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 680   7                    Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 681   7                    Delay_ngao(30000);
 682   7                    Lcd_Out(1, 1, "CAI DAT BAO THUC");
 683   7                    while (temp == 2 && mode_clock == 2)
 684   7                    {
 685   8                      char old_Minute_setup = Minute_setup;
 686   8                      if (BTN_MOVE == 0)
 687   8                      {
 688   9                        delay_ms1(15);
 689   9                        if (BTN_MOVE == 0)
 690   9                          temp = temp + 1;
 691   9                        do
 692   9                        {
 693  10                        } while (BTN_MOVE == 0);
 694   9                      }
 695   8                      else if (BTN_DOWN == 0)
 696   8                      {
 697   9                        delay_ms1(15);
 698   9                        do
 699   9                        {
 700  10                        } while (BTN_DOWN == 0);
 701   9                        if (Minute_setup == 0)
 702   9                          Minute_setup = 60;
 703   9                        Minute_setup--;
 704   9                      }
 705   8                      else if (BTN_UP == 0)
 706   8                      {
 707   9                        delay_ms1(15);
 708   9                        do
 709   9                        {
 710  10                        } while (BTN_UP == 0);
 711   9                        if (Minute_setup == 59)
 712   9                          Minute_setup = -1;
 713   9                        Minute_setup++;
 714   9                      }
 715   8                      else
 716   8                      {
 717   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 718   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 719   9                        Lcd_Chr_Cp(':');
 720   9                        Lcd_Out(2, 9, "  ");
 721   9                        timer_delay();
 722   9      
 723   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 724   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 725   9                        Lcd_Chr_Cp(':');
 726   9                        Lcd_Chr(2, 9, Minute_setup / 10 + 0x30);
 727   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 728   9                        // Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 729   9                        // Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 730   9                        timer_delay();
 731   9                      }
 732   8                      if (old_Minute_setup != Minute_setup)
 733   8                      {
 734   9                        old_Minute_setup = Minute_setup;
 735   9                        Lcd_Chr(2, 6, Hour_setup / 10 + 0x30);
 736   9                        Lcd_Chr_Cp(Hour_setup % 10 + 0x30);
 737   9                        Lcd_Chr_Cp(':');
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 13  

 738   9                        Lcd_Chr_Cp(Minute_setup / 10 + 0x30);
 739   9                        Lcd_Chr_Cp(Minute_setup % 10 + 0x30);
 740   9                      }
 741   8                      if (temp != 2)
 742   8                      {
 743   9                        Lcd_Cmd(1);
 744   9                        break;
 745   9                      }
 746   8                    }
 747   7                    break;
 748   7                  default:
 749   7                    break;
 750   7                  }
 751   6                  if (temp >= 3)
 752   6                  {
 753   7                    mode_clock++;
 754   7                    break;
 755   7                  }
 756   6                }
 757   5                if (mode_clock != 2)
 758   5                  break;
 759   5              }
 760   4              break;
 761   4            case 3:
 762   4              demc = 1;
 763   4              Lcd_Cmd(1);
 764   4              Lcd_Out(1, 2, "DONG HO BAM GIO");
 765   4              Lcd_Chr(2, 5, Hou_CL / 10 + 0x30);
 766   4              Lcd_Chr_Cp(Hou_CL % 10 + 0x30);
 767   4              Lcd_Chr_Cp(':');
 768   4              Lcd_Chr_Cp(Minute_CL / 10 + 0x30);
 769   4              Lcd_Chr_Cp(Minute_CL % 10 + 0x30);
 770   4              Lcd_Chr_Cp(':');
 771   4              Lcd_Chr_Cp(Second_CL / 10 + 0x30);
 772   4              Lcd_Chr_Cp(Second_CL % 10 + 0x30);
 773   4              delay_ms1(15);
 774   4              while (mode_clock == 3)
 775   4              {
 776   5                char old_Hou_CL = Hou_CL;
 777   5                if (BTN_MOVE == 0)
 778   5                {
 779   6                  delay_ms1(15);
 780   6                  if (BTN_MOVE == 0)
 781   6                    demc = demc + 1;
 782   6                  do
 783   6                  {
 784   7                  } while (BTN_MOVE == 0);
 785   6                  while (demc % 2 == 0 && mode_clock == 3)
 786   6                  {
 787   7                    int j = 0;
 788   7                    Second_CL++;
 789   7                    for (hi = 0; hi < 35; hi++)
 790   7                    {
 791   8                      // delay_ms_CL(10);
 792   8                      // delay_ms_CL(10);
 793   8                      // delay_ms_CL(10);
 794   8                      for (j = 0; j < 25; j++)
 795   8                      {
 796   9                        timer_delay();
 797   9                      }
 798   8                      Lcd_Chr(2, 5, Hou_CL / 10 + 0x30);
 799   8                      Lcd_Chr_Cp(Hou_CL % 10 + 0x30);
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 14  

 800   8                      Lcd_Chr_Cp(':');
 801   8                      Lcd_Chr_Cp(Minute_CL / 10 + 0x30);
 802   8                      Lcd_Chr_Cp(Minute_CL % 10 + 0x30);
 803   8                      Lcd_Chr_Cp(':');
 804   8                      Lcd_Chr_Cp(Second_CL / 10 + 0x30);
 805   8                      Lcd_Chr_Cp(Second_CL % 10 + 0x30);
 806   8                    }
 807   7                    if (BTN_MOVE == 0)
 808   7                    {
 809   8                      delay_ms1(15);
 810   8                      demc = demc + 1;
 811   8                      do
 812   8                      {
 813   9                      } while (BTN_MOVE == 0);
 814   8                    }
 815   7                    else if (BTN_DOWN == 0)
 816   7                    {
 817   8                      delay_ms1(15);
 818   8                      do
 819   8                      {
 820   9                      } while (BTN_DOWN == 0);
 821   8                      Hou_CL = 0;
 822   8                      Minute_CL = 0;
 823   8                      Second_CL = 0;
 824   8                      Lcd_Chr(2, 5, Hou_CL / 10 + 0x30);
 825   8                      Lcd_Chr_Cp(Hou_CL % 10 + 0x30);
 826   8                      Lcd_Chr_Cp(':');
 827   8                      Lcd_Chr_Cp(Minute_CL / 10 + 0x30);
 828   8                      Lcd_Chr_Cp(Minute_CL % 10 + 0x30);
 829   8                      Lcd_Chr_Cp(':');
 830   8                      Lcd_Chr_Cp(Second_CL / 10 + 0x30);
 831   8                      Lcd_Chr_Cp(Second_CL % 10 + 0x30);
 832   8                      demc++;
 833   8                    }
 834   7                    if (Second_CL == 59)
 835   7                      Minute_CL++;
 836   7                    if (Minute_CL == 59)
 837   7                      Hou_CL++;
 838   7                    if (Second_CL > 59)
 839   7                      Second_CL = 0;
 840   7                    if (Minute_CL > 59)
 841   7                      Minute_CL = 0;
 842   7                  }
 843   6                }
 844   5                if (BTN_DOWN == 0)
 845   5                {
 846   6                  delay_ms1(15);
 847   6                  do
 848   6                  {
 849   7                  } while (BTN_DOWN == 0);
 850   6                  Hou_CL = 0;
 851   6                  Minute_CL = 0;
 852   6                  Second_CL = 0;
 853   6                  Lcd_Chr(2, 5, Hou_CL / 10 + 0x30);
 854   6                  Lcd_Chr_Cp(Hou_CL % 10 + 0x30);
 855   6                  Lcd_Chr_Cp(':');
 856   6                  Lcd_Chr_Cp(Minute_CL / 10 + 0x30);
 857   6                  Lcd_Chr_Cp(Minute_CL % 10 + 0x30);
 858   6                  Lcd_Chr_Cp(':');
 859   6                  Lcd_Chr_Cp(Second_CL / 10 + 0x30);
 860   6                  Lcd_Chr_Cp(Second_CL % 10 + 0x30);
 861   6                }
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 15  

 862   5              }
 863   4              break;
 864   4            default:
 865   4              //LED = 1;
 866   4              //Delay(50000);
 867   4              break; // Error handling
 868   4            }
 869   3            if (mode_clock >= 4)
 870   3            {
 871   4              Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 872   4              Ds1307_Write_Date(Day, Date, Month, Year);
 873   4              Ds1307_Init();
 874   4              mode_clock = 0;
 875   4              break;
 876   4            }
 877   3          }
 878   2          //==================
 879   2          if (BTN_MOVE == 0)
 880   2          {
 881   3            LED = 0;
 882   3            delay_ms1(15);
 883   3            if (BTN_MOVE == 0)
 884   3            {
 885   4              if (Mode == 12)
 886   4              {
 887   5                if (am_pm == 1)
 888   5                  Hour = Hour + 12;
 889   5                Mode = 24;
 890   5              }
 891   4              else
 892   4              {
 893   5                if (Hour >= 12)
 894   5                  Hour = Hour - 12;
 895   5                Mode = 12;
 896   5              }
 897   4              Ds1307_Write_Time(Hour, Minute, Second, Mode, am_pm);
 898   4              Ds1307_Init();
 899   4            }
 900   3            do
 901   3            {
 902   4            } while (BTN_MOVE == 0);
 903   3          }
 904   2      
 905   2          if ((Hour_setup == Hour) && (Minute_setup == Minute))
 906   2          {
 907   3            LED1 = 1;
 908   3            Delay_ngao(10000000);
 909   3            Hour_setup = 24;
 910   3            Minute_setup = 24;
 911   3          }
 912   2          else
 913   2            LED1 = 0;
 914   2          //Baothuc(Hour_setup, Minute_setup, Hour, Minute_setup);
 915   2        }
 916   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3871    ----
   CONSTANT SIZE    =    124    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   MAIN                                                              06/23/2021 22:50:10 PAGE 16  

   DATA SIZE        =     14      26
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
